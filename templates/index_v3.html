<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Matrix Control Panel</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2c3e50',
                        secondary: '#3498db',
                        accent: '#e74c3c',
                        success: '#27ae60',
                        warning: '#f39c12',
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <!-- Sortable.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Styles (for elements Tailwind can't handle) -->
    <style>
        /* LED Display specific styles */
        .display-image {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .grid-overlay,
        .led-canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Toggle Switch (custom component) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Smooth scrollbar for tab content */
        .tab-content {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }

        .tab-content::-webkit-scrollbar {
            width: 8px;
        }

        .tab-content::-webkit-scrollbar-track {
            background: #f7fafc;
        }

        .tab-content::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-tv"></i> LED Matrix Control Panel - Enhanced</h1>
            <div class="system-status">
                <div class="status-item {{ 'status-active' if system_status.service_active else 'status-inactive' }}">
                    <i class="fas fa-{{ 'play' if system_status.service_active else 'stop' }}"></i>
                    Service {{ 'Active' if system_status.service_active else 'Inactive' }}
                </div>
                <div class="status-item {{ 'status-warning' if system_status and system_status.cpu_percent and system_status.cpu_percent > 80 else 'status-active' }}">
                    <i class="fas fa-microchip"></i>
                    {{ system_status.cpu_percent if system_status and system_status.cpu_percent is defined else 0 }}% CPU
                </div>
                <div class="status-item {{ 'status-warning' if system_status and system_status.memory_used_percent and system_status.memory_used_percent > 80 else 'status-active' }}">
                    <i class="fas fa-memory"></i>
                    {{ system_status.memory_used_percent if system_status and system_status.memory_used_percent is defined else 0 }}% RAM
                </div>
                <div class="status-item {{ 'status-warning' if system_status and system_status.cpu_temp and system_status.cpu_temp > 70 else 'status-active' }}">
                    <i class="fas fa-thermometer-half"></i>
                    {{ system_status.cpu_temp if system_status and system_status.cpu_temp is defined else 0 }}°C
                </div>
                <div class="status-item status-active">
                    <i class="fas fa-clock"></i>
                    {{ system_status.uptime }}
                </div>
            </div>
        </div>

        <!-- Quick Controls -->
        <div class="quick-controls">
            <h2 style="margin-bottom:12px;"><i class="fas fa-bolt"></i> Quick Controls</h2>
            <div class="display-controls">
                <button class="btn btn-success" onclick="runAction('start_display')"><i class="fas fa-play"></i> Start Display</button>
                <button class="btn btn-danger" onclick="runAction('stop_display')"><i class="fas fa-stop"></i> Stop Display</button>
                <button class="btn btn-primary" onclick="systemAction('restart_service')"><i class="fas fa-redo"></i> Restart Service</button>
                <button class="btn btn-warning" onclick="systemAction('git_pull')"><i class="fas fa-download"></i> Update Code</button>
                <button class="btn btn-info" onclick="systemAction('migrate_config')"><i class="fas fa-sync-alt"></i> Migrate Config</button>
                <button class="btn btn-danger" onclick="systemAction('reboot_system')"><i class="fas fa-power-off"></i> Reboot</button>
                <button class="btn btn-secondary" onclick="stopOnDemand()"><i class="fas fa-ban"></i> Stop On-Demand</button>
                <span id="ondemand-status" style="margin-left:auto; font-size:12px; color:#333; background:#f3f3f3; padding:6px 10px; border-radius:8px;">On-Demand: None</span>
            </div>
            <div style="margin-top:12px; color:#666; font-size:12px;">Service actions may require sudo privileges on the Pi. Migrate Config adds new options with defaults while preserving your settings.</div>
        </div>

        <!-- Editor Mode Banner -->
        {% if editor_mode %}
        <div class="editor-mode">
            <h2><i class="fas fa-edit"></i> Display Editor Mode Active</h2>
            <p>Normal display operation is paused. Use the tools below to customize your display layout.</p>
        </div>
        {% endif %}

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Display Panel -->
            <div class="display-panel" style="max-width: 1200px; margin: 0 auto;">
                <h2><i class="fas fa-desktop"></i> Live Display Preview</h2>
                <div class="display-preview" id="displayPreview">
                    <div id="previewStage" class="preview-stage" style="display:none;">
                        <div id="previewMeta" style="position:absolute; top:-28px; left:0; color:#ddd; font-size:12px; opacity:0.85;"></div>
                        <img id="displayImage" class="display-image" alt="LED Matrix Display">
                        <canvas id="ledCanvas" class="led-canvas" style="display:none;"></canvas>
                        <canvas id="gridOverlay" class="grid-overlay"></canvas>
                    </div>
                    <div id="displayPlaceholder" style="color: #666; font-size: 1.2rem;">
                        <i class="fas fa-spinner fa-spin"></i>
                        Connecting to display...
                    </div>
                </div>
                <div class="display-controls">
                    <button class="btn btn-warning" onclick="toggleEditorMode()">
                        <i class="fas fa-edit"></i> 
                        {{ 'Exit Editor' if editor_mode else 'Enter Editor' }}
                    </button>
                    <button class="btn btn-primary" onclick="takeScreenshot()">
                        <i class="fas fa-camera"></i> Screenshot
                    </button>
                    <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin-left:auto;">
                        <label style="color:#333; background:#f3f3f3; padding:6px 10px; border-radius:8px;">
                            Scale
                            <input type="range" id="scaleRange" min="2" max="16" value="8" style="vertical-align:middle;">
                            <span id="scaleValue">8x</span>
                        </label>
                        <label style="color:#333; background:#f3f3f3; padding:6px 10px; border-radius:8px; display:inline-flex; align-items:center; gap:8px;">
                            <input type="checkbox" id="toggleGrid">
                            Show pixel grid
                        </label>
                        <label style="color:#333; background:#f3f3f3; padding:6px 10px; border-radius:8px; display:inline-flex; align-items:center; gap:8px;">
                            <input type="checkbox" id="toggleLedDots" checked>
                            LED dot mode
                        </label>
                        <label style="color:#333; background:#f3f3f3; padding:6px 10px; border-radius:8px; display:inline-flex; align-items:center; gap:8px;">
                            Dot fill
                            <input type="range" id="dotFillRange" min="40" max="95" value="75">
                            <span id="dotFillValue">75%</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Control Panel under the preview, wider -->
            <div class="control-panel">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('overview')">
                        <i class="fas fa-tachometer-alt"></i> Overview
                    </button>
                    <button class="tab-btn" onclick="showTab('general')">
                        <i class="fas fa-sliders-h"></i> General
                    </button>
                    <button class="tab-btn" onclick="showTab('schedule')">
                        <i class="fas fa-calendar"></i> Schedule
                    </button>
                    <button class="tab-btn" onclick="showTab('display')">
                        <i class="fas fa-cog"></i> Display
                    </button>
                    <button class="tab-btn" onclick="showTab('clock')">
                        <i class="fas fa-clock"></i> Clock
                    </button>
                    <button class="tab-btn" onclick="showTab('durations')">
                        <i class="fas fa-hourglass-half"></i> Durations
                    </button>
                    <button class="tab-btn" onclick="showTab('sports')">
                        <i class="fas fa-football-ball"></i> Sports
                    </button>
                    <button class="tab-btn" onclick="showTab('weather')">
                        <i class="fas fa-cloud-sun"></i> Weather
                    </button>
                    <button class="tab-btn" onclick="showTab('stocks')">
                        <i class="fas fa-chart-line"></i> Stocks
                    </button>
                    <button class="tab-btn" onclick="showTab('stocknews')">
                        <i class="fas fa-newspaper"></i> Stock News
                    </button>
                    <button class="tab-btn" onclick="showTab('odds')">
                        <i class="fas fa-ticket-alt"></i> Odds Ticker
                    </button>
                    <button class="tab-btn" onclick="showTab('leaderboard')">
                        <i class="fas fa-trophy"></i> Leaderboard
                    </button>
                    <button class="tab-btn" onclick="showTab('text')">
                        <i class="fas fa-font"></i> Text
                    </button>
                    <button class="tab-btn" onclick="showTab('features')">
                        <i class="fas fa-star"></i> Features
                    </button>
                    <button class="tab-btn" onclick="showTab('of_the_day')">
                        <i class="fas fa-calendar-day"></i> Of The Day
                    </button>
                    <button class="tab-btn" onclick="showTab('music')">
                        <i class="fas fa-music"></i> Music
                    </button>
                    <button class="tab-btn" onclick="showTab('calendar')">
                        <i class="fas fa-calendar-alt"></i> Calendar
                    </button>
                    <button class="tab-btn" onclick="showTab('youtube')">
                        <i class="fab fa-youtube"></i> YouTube
                    </button>
                    <button class="tab-btn" onclick="showTab('news')">
                        <i class="fas fa-newspaper"></i> News
                    </button>
                    <button class="tab-btn" onclick="showTab('secrets')">
                        <i class="fas fa-key"></i> API Keys
                    </button>
                    <button class="tab-btn" onclick="showTab('editor')">
                        <i class="fas fa-paint-brush"></i> Editor
                    </button>
                    <button class="tab-btn" onclick="showTab('actions')">
                        <i class="fas fa-tools"></i> Actions
                    </button>
                    <button class="tab-btn" onclick="showTab('raw-json')">
                        <i class="fas fa-code"></i> Raw JSON
                    </button>
                    <button class="tab-btn" onclick="showTab('logs')">
                        <i class="fas fa-file-alt"></i> Logs
                    </button>
                </div>

                <!-- Overview Tab -->
                <div id="overview" class="tab-content active">
                    <h3>System Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">{{ system_status.cpu_percent if system_status and system_status.cpu_percent is defined else 0 }}%</div>
                            <div class="stat-label">CPU Usage</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ system_status.memory_used_percent if system_status and system_status.memory_used_percent is defined else 0 }}%</div>
                            <div class="stat-label">Memory Usage</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ system_status.cpu_temp if system_status and system_status.cpu_temp is defined else 0 }}°C</div>
                            <div class="stat-label">CPU Temperature</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ main_config.get('display', {}).get('hardware', {}).get('brightness', 0) }}</div>
                            <div class="stat-label">Brightness</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ main_config.get('display', {}).get('hardware', {}).get('cols', 0) }}x{{ main_config.get('display', {}).get('hardware', {}).get('rows', 0) }}</div>
                            <div class="stat-label">Resolution</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ system_status.disk_used_percent if system_status and system_status.disk_used_percent is defined else 0 }}%</div>
                            <div class="stat-label">Disk Usage</div>
                        </div>
                    </div>

                    <h4>API Calls (24h window)</h4>
                    <div id="api-metrics" class="stat-card" style="text-align:left;">
                        <div>Loading API metrics...</div>
                        <div style="margin-top:10px; font-size:12px; color:#666;">If empty, ensure the server is running and /api/metrics is reachable.</div>
                        <div style="margin-top:10px;">
                            <button class="btn btn-primary" onclick="updateApiMetrics()"><i class="fas fa-sync"></i> Refresh API Metrics</button>
                        </div>
                    </div>

                    <h4>Quick Actions</h4>
                    <div class="display-controls">
                        <button class="btn btn-primary" onclick="systemAction('restart_service')">
                            <i class="fas fa-redo"></i> Restart Service
                        </button>
                        <button class="btn btn-warning" onclick="systemAction('git_pull')">
                            <i class="fas fa-download"></i> Update Code
                        </button>
                        <button class="btn btn-info" onclick="systemAction('migrate_config')">
                            <i class="fas fa-sync-alt"></i> Migrate Config
                        </button>
                        <button class="btn btn-danger" onclick="systemAction('reboot_system')">
                            <i class="fas fa-power-off"></i> Reboot System
                        </button>
                    </div>
                </div>

                <!-- General Tab -->
                <div id="general" class="tab-content">
                    <div class="config-section">
                        <h3>General Settings</h3>
                        <form id="general-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="web_display_autostart" name="web_display_autostart" {% if safe_config_get(main_config, 'web_display_autostart', default=True) %}checked{% endif %}>
                                    Web Display Autostart
                                </label>
                                <div class="description">Start the web interface on boot for easier access.</div>
                            </div>
                            <div class="form-group">
                                <label for="timezone">Timezone</label>
                                <input type="text" class="form-control" id="timezone" name="timezone" value="{{ safe_config_get(main_config, 'timezone', default='America/Chicago') }}" placeholder="e.g., America/Chicago">
                                <div class="description">IANA timezone, affects time-based features and scheduling.</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" class="form-control" id="city" name="city" value="{{ safe_config_get(main_config, 'location', 'city', default='Dallas') }}">
                                </div>
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <input type="text" class="form-control" id="state" name="state" value="{{ safe_config_get(main_config, 'location', 'state', default='Texas') }}">
                                </div>
                                <div class="form-group">
                                    <label for="country">Country</label>
                                    <input type="text" class="form-control" id="country" name="country" value="{{ safe_config_get(main_config, 'location', 'country', default='US') }}">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success">Save General Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Schedule Tab -->
                <div id="schedule" class="tab-content">
                    <div class="config-section">
                        <h3>Display Schedule</h3>
                        <p>Set the time for the display to be active. A restart is needed for changes to take effect.</p>
                        <form id="schedule-form">
                            <div class="form-group">
                                <label for="schedule_enabled">Enable Schedule:</label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="schedule_enabled" name="schedule_enabled" {% if schedule_config.enabled %}checked{% endif %}>
                                        <span class="slider"></span>
                                    </label>
                                    <span>Turn display on/off automatically</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="start_time">Display On Time:</label>
                                <input type="time" class="form-control" id="start_time" name="start_time" value="{{ schedule_config.start_time }}">
                                <div class="description">Time when the display should turn on</div>
                            </div>
                            <div class="form-group">
                                <label for="end_time">Display Off Time:</label>
                                <input type="time" class="form-control" id="end_time" name="end_time" value="{{ schedule_config.end_time }}">
                                <div class="description">Time when the display should turn off</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Schedule</button>
                        </form>
                    </div>
                </div>

                <!-- Display Settings Tab -->
                <div id="display" class="tab-content">
                    <div class="config-section">
                        <h3>LED Matrix Hardware Settings</h3>
                        <form id="display-form">
                            <div class="form-row">
                                <div>
                                    <div class="form-group">
                                        <label for="rows">Rows:</label>
                                        <input type="number" class="form-control" id="rows" name="rows" value="{{ safe_config_get(main_config, 'display', 'hardware', 'rows', default=32) }}" min="1" max="64">
                                        <div class="description">Number of LED rows</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="cols">Columns:</label>
                                        <input type="number" class="form-control" id="cols" name="cols" value="{{ safe_config_get(main_config, 'display', 'hardware', 'cols', default=64) }}" min="1" max="128">
                                        <div class="description">Number of LED columns</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="chain_length">Chain Length:</label>
                                        <input type="number" class="form-control" id="chain_length" name="chain_length" value="{{ safe_config_get(main_config, 'display', 'hardware', 'chain_length', default=2) }}" min="1" max="8">
                                        <div class="description">Number of LED panels chained together</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="parallel">Parallel:</label>
                                        <input type="number" class="form-control" id="parallel" name="parallel" value="{{ safe_config_get(main_config, 'display', 'hardware', 'parallel', default=1) }}" min="1" max="4">
                                        <div class="description">Number of parallel chains</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="brightness">Brightness:</label>
                                        <input type="range" class="form-control" id="brightness" name="brightness" value="{{ safe_config_get(main_config, 'display', 'hardware', 'brightness', default=95) }}" min="1" max="100" oninput="updateBrightnessDisplay(this.value)">
                                        <div class="description">LED brightness: <span id="brightness-value">{{ safe_config_get(main_config, 'display', 'hardware', 'brightness', default=95) }}</span>%</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="hardware_mapping">Hardware Mapping:</label>
                                        <select class="form-control" id="hardware_mapping" name="hardware_mapping">
                                            <option value="adafruit-hat-pwm" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "adafruit-hat-pwm" %}selected{% endif %}>Adafruit HAT PWM</option>
                                            <option value="adafruit-hat" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "adafruit-hat" %}selected{% endif %}>Adafruit HAT</option>
                                            <option value="regular" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "regular" %}selected{% endif %}>Regular</option>
                                            <option value="regular-pi1" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "regular-pi1" %}selected{% endif %}>Regular Pi1</option>
                                        </select>
                                        <div class="description">Hardware mapping type</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="form-group">
                                        <label for="gpio_slowdown">GPIO Slowdown:</label>
                                        <input type="number" class="form-control" id="gpio_slowdown" name="gpio_slowdown" value="{{ safe_config_get(main_config, 'display', 'runtime', 'gpio_slowdown', default=3) }}" min="0" max="5">
                                        <div class="description">GPIO slowdown factor (0-5)</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="scan_mode">Scan Mode:</label>
                                        <input type="number" class="form-control" id="scan_mode" name="scan_mode" value="{{ safe_config_get(main_config, 'display', 'hardware', 'scan_mode', default=0) }}" min="0" max="1">
                                        <div class="description">Scan mode for LED matrix (0-1)</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="pwm_bits">PWM Bits:</label>
                                        <input type="number" class="form-control" id="pwm_bits" name="pwm_bits" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_bits', default=9) }}" min="1" max="11">
                                        <div class="description">PWM bits for brightness control (1-11)</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="pwm_dither_bits">PWM Dither Bits:</label>
                                        <input type="number" class="form-control" id="pwm_dither_bits" name="pwm_dither_bits" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_dither_bits', default=1) }}" min="0" max="4">
                                        <div class="description">PWM dither bits (0-4)</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="pwm_lsb_nanoseconds">PWM LSB Nanoseconds:</label>
                                        <input type="number" class="form-control" id="pwm_lsb_nanoseconds" name="pwm_lsb_nanoseconds" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_lsb_nanoseconds', default=130) }}" min="50" max="500">
                                        <div class="description">PWM LSB nanoseconds (50-500)</div>
                                    </div>
                                    <div class="form-group">
                                        <label for="limit_refresh_rate_hz">Limit Refresh Rate (Hz):</label>
                                        <input type="number" class="form-control" id="limit_refresh_rate_hz" name="limit_refresh_rate_hz" value="{{ safe_config_get(main_config, 'display', 'hardware', 'limit_refresh_rate_hz', default=120) }}" min="1" max="1000">
                                        <div class="description">Limit refresh rate in Hz (1-1000)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="disable_hardware_pulsing" name="disable_hardware_pulsing" {% if safe_config_get(main_config, 'display', 'hardware', 'disable_hardware_pulsing', default=False) %}checked{% endif %}>
                                        Disable Hardware Pulsing
                                    </label>
                                    <div class="description">Disable hardware pulsing</div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="inverse_colors" name="inverse_colors" {% if safe_config_get(main_config, 'display', 'hardware', 'inverse_colors', default=False) %}checked{% endif %}>
                                        Inverse Colors
                                    </label>
                                    <div class="description">Inverse color display</div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="show_refresh_rate" name="show_refresh_rate" {% if safe_config_get(main_config, 'display', 'hardware', 'show_refresh_rate', default=False) %}checked{% endif %}>
                                        Show Refresh Rate
                                    </label>
                                    <div class="description">Show refresh rate on display</div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="use_short_date_format" name="use_short_date_format" {% if safe_config_get(main_config, 'display', 'use_short_date_format', default=True) %}checked{% endif %}>
                                        Use Short Date Format
                                    </label>
                                    <div class="description">Use short date format for display</div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Save Display Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Clock Tab -->
                <div id="clock" class="tab-content">
                    <div class="config-section">
                        <h3>Clock</h3>
                        <form id="clock-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="clock_enabled" {% if safe_config_get(main_config, 'clock', 'enabled', default=True) %}checked{% endif %}>
                                    Enable Clock
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="clock_format">Format</label>
                                <input type="text" id="clock_format" class="form-control" value="{{ safe_config_get(main_config, 'clock', 'format', default='%I:%M %p') }}">
                                <div class="description">Python strftime format. Example: %I:%M %p for 12-hour time.</div>
                            </div>
                            <div class="form-group">
                                <label for="clock_update_interval">Update Interval (seconds)</label>
                                <input type="number" id="clock_update_interval" class="form-control" value="{{ safe_config_get(main_config, 'clock', 'update_interval', default=1) }}" min="1" max="60">
                            </div>
                            <button type="submit" class="btn btn-success">Save Clock Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Durations Tab -->
                <div id="durations" class="tab-content">
                    <div class="config-section">
                        <h3>Rotation Durations</h3>
                        <p class="description">How long each screen is shown before switching. Values in seconds.</p>
                        <form id="durations-form">
                            <div class="form-row">
                                {% for key, value in main_config.get('display', {}).get('display_durations', {}).items() %}
                                <div class="form-group">
                                    <label for="duration_{{ key }}">{{ key | replace('_', ' ') | title }}</label>
                                    <input type="number" class="form-control duration-input" id="duration_{{ key }}" data-name="{{ key }}" value="{{ value }}" min="5" max="600">
                                </div>
                                {% endfor %}
                            </div>
                            <button type="submit" class="btn btn-success">Save Durations</button>
                        </form>
                    </div>
                </div>

                <!-- Sports Tab -->
                <div id="sports" class="tab-content">
                    <div class="config-section">
                        <h3>Sports Configuration</h3>
                        <p>Configure which sports leagues to display and their settings.</p>
                        <!-- Sports configuration will be populated by JavaScript -->
                        <div id="sports-config">
                            Loading sports configuration...
                        </div>
                <div style="margin-top:10px; display:flex; gap:10px;">
                    <button type="button" class="btn btn-primary" onclick="refreshSportsConfig()">Refresh</button>
                    <button type="button" class="btn btn-success" onclick="saveSportsConfig()">Save Sports Settings</button>
                </div>
                    </div>
                </div>

                <!-- Weather Tab -->
                <div id="weather" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Weather Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('weather_current')"><i class="fas fa-bolt"></i> On-Demand Current</button>
                                <button type="button" class="btn btn-info" onclick="startOnDemand('weather_hourly')"><i class="fas fa-bolt"></i> Hourly</button>
                                <button type="button" class="btn btn-info" onclick="startOnDemand('weather_daily')"><i class="fas fa-bolt"></i> Daily</button>
                            </div>
                        </div>
                        <form id="weather-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="weather_enabled" name="weather_enabled" {% if safe_config_get(main_config, 'weather', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Weather
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="weather_city">City:</label>
                                <input type="text" class="form-control" id="weather_city" name="weather_city" value="{{ safe_config_get(main_config, 'location', 'city', default='Dallas') }}">
                                <div class="description">City name for weather data</div>
                            </div>
                            <div class="form-group">
                                <label for="weather_state">State:</label>
                                <input type="text" class="form-control" id="weather_state" name="weather_state" value="{{ safe_config_get(main_config, 'location', 'state', default='Texas') }}">
                                <div class="description">State/province name</div>
                            </div>
                            <div class="form-group">
                                <label for="weather_units">Units:</label>
                                <select class="form-control" id="weather_units" name="weather_units">
                                    <option value="imperial" {% if safe_config_get(main_config, 'weather', 'units', default='imperial') == "imperial" %}selected{% endif %}>Fahrenheit</option>
                                    <option value="metric" {% if safe_config_get(main_config, 'weather', 'units', default='imperial') == "metric" %}selected{% endif %}>Celsius</option>
                                </select>
                                <div class="description">Temperature units</div>
                            </div>
                            <div class="form-group">
                                <label for="weather_display_format">Display Format</label>
                                <textarea id="weather_display_format" class="form-control" rows="2">{{ safe_config_get(main_config, 'weather', 'display_format', default='{temp}°F\n{condition}') }}</textarea>
                                <div class="description">Use tokens like {temp}, {condition}. Supports new lines.</div>
                            </div>
                            <div class="form-group">
                                <label for="weather_update_interval">Update Interval (seconds):</label>
                                <input type="number" class="form-control" id="weather_update_interval" name="weather_update_interval" value="{{ safe_config_get(main_config, 'weather', 'update_interval', default=1800) }}" min="300" max="3600">
                                <div class="description">How often to update weather data (300-3600 seconds)</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Weather Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Stocks Tab -->
                <div id="stocks" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Stocks & Crypto Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('stocks')"><i class="fas fa-bolt"></i> On-Demand Stocks</button>
                            </div>
                        </div>
                        <form id="stocks-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="stocks_enabled" name="stocks_enabled" {% if safe_config_get(main_config, 'stocks', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Stocks
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="stocks_symbols">Stock Symbols:</label>
                                <input type="text" class="form-control" id="stocks_symbols" name="stocks_symbols" value="{{ safe_config_get(main_config, 'stocks', 'symbols', default=['ASTS', 'SCHD', 'INTC', 'NVDA', 'T', 'VOO', 'SMCI'])|join(', ') }}" placeholder="AAPL, GOOGL, MSFT">
                                <div class="description">Comma-separated stock symbols</div>
                            </div>
                            <div class="form-group">
                                <label for="stocks_update_interval">Update Interval (seconds):</label>
                                <input type="number" class="form-control" id="stocks_update_interval" name="stocks_update_interval" value="{{ safe_config_get(main_config, 'stocks', 'update_interval', default=600) }}" min="60" max="3600">
                                <div class="description">How often to update stock data</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stocks_scroll_speed">Scroll Speed</label>
                                    <input type="number" step="0.1" class="form-control" id="stocks_scroll_speed" value="{{ safe_config_get(main_config, 'stocks', 'scroll_speed', default=1) }}">
                                    <div class="description">Horizontal scroll pixels per step.</div>
                                </div>
                                <div class="form-group">
                                    <label for="stocks_scroll_delay">Scroll Delay (seconds)</label>
                                    <input type="number" step="0.001" class="form-control" id="stocks_scroll_delay" value="{{ safe_config_get(main_config, 'stocks', 'scroll_delay', default=0.01) }}">
                                    <div class="description">Delay between scroll steps.</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="stocks_toggle_chart" name="stocks_toggle_chart" {% if safe_config_get(main_config, 'stocks', 'toggle_chart', default=True) %}checked{% endif %}>
                                    Show Charts
                                </label>
                                <div class="description">Display mini charts alongside stock ticker data</div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="stocks_dynamic_duration" {% if safe_config_get(main_config, 'stocks', 'dynamic_duration', default=True) %}checked{% endif %}>
                                    Dynamic Duration
                                </label>
                                <div class="description">Adjust display duration based on content length.</div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stocks_min_duration">Min Duration (sec)</label>
                                    <input type="number" class="form-control" id="stocks_min_duration" value="{{ safe_config_get(main_config, 'stocks', 'min_duration', default=30) }}">
                                </div>
                                <div class="form-group">
                                    <label for="stocks_max_duration">Max Duration (sec)</label>
                                    <input type="number" class="form-control" id="stocks_max_duration" value="{{ safe_config_get(main_config, 'stocks', 'max_duration', default=300) }}">
                                </div>
                                <div class="form-group">
                                    <label for="stocks_duration_buffer">Duration Buffer</label>
                                    <input type="number" step="0.01" class="form-control" id="stocks_duration_buffer" value="{{ safe_config_get(main_config, 'stocks', 'duration_buffer', default=0.1) }}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="stocks_display_format">Display Format</label>
                                <input type="text" class="form-control" id="stocks_display_format" value="{{ safe_config_get(main_config, 'stocks', 'display_format', default='{symbol}: ${price} ({change}%)') }}">
                                <div class="description">Use tokens like {symbol}, {price}, {change}.</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Stocks Settings</button>
                        </form>

                        <h3>Cryptocurrency</h3>
                        <form id="crypto-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="crypto_enabled" name="crypto_enabled" {% if safe_config_get(main_config, 'crypto', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Crypto
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="crypto_symbols">Crypto Symbols:</label>
                                <input type="text" class="form-control" id="crypto_symbols" name="crypto_symbols" value="{{ safe_config_get(main_config, 'crypto', 'symbols', default=['BTC-USD', 'ETH-USD'])|join(', ') }}" placeholder="BTC-USD, ETH-USD">
                                <div class="description">Comma-separated crypto symbols (e.g., BTC-USD, ETH-USD)</div>
                            </div>
                            <div class="form-group">
                                <label for="crypto_update_interval">Update Interval (seconds):</label>
                                <input type="number" class="form-control" id="crypto_update_interval" name="crypto_update_interval" value="{{ safe_config_get(main_config, 'crypto', 'update_interval', default=600) }}" min="60" max="3600">
                                <div class="description">How often to update crypto data</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Crypto Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Stock News Tab -->
                <div id="stocknews" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Stock News</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('stock_news')"><i class="fas fa-bolt"></i> On-Demand News</button>
                            </div>
                        </div>
                        <form id="stocknews-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="stocknews_enabled" {% if safe_config_get(main_config, 'stock_news', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Stock News
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stocknews_update_interval">Update Interval (sec)</label>
                                    <input type="number" class="form-control" id="stocknews_update_interval" value="{{ safe_config_get(main_config, 'stock_news', 'update_interval', default=3600) }}">
                                </div>
                                <div class="form-group">
                                    <label for="stocknews_scroll_speed">Scroll Speed</label>
                                    <input type="number" step="0.1" class="form-control" id="stocknews_scroll_speed" value="{{ safe_config_get(main_config, 'stock_news', 'scroll_speed', default=1) }}">
                                </div>
                                <div class="form-group">
                                    <label for="stocknews_scroll_delay">Scroll Delay (sec)</label>
                                    <input type="number" step="0.001" class="form-control" id="stocknews_scroll_delay" value="{{ safe_config_get(main_config, 'stock_news', 'scroll_delay', default=0.01) }}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stocknews_max_headlines_per_symbol">Max Headlines per Symbol</label>
                                    <input type="number" class="form-control" id="stocknews_max_headlines_per_symbol" value="{{ safe_config_get(main_config, 'stock_news', 'max_headlines_per_symbol', default=1) }}">
                                </div>
                                <div class="form-group">
                                    <label for="stocknews_headlines_per_rotation">Headlines per Rotation</label>
                                    <input type="number" class="form-control" id="stocknews_headlines_per_rotation" value="{{ safe_config_get(main_config, 'stock_news', 'headlines_per_rotation', default=2) }}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="stocknews_dynamic_duration" {% if safe_config_get(main_config, 'stock_news', 'dynamic_duration', default=True) %}checked{% endif %}>
                                    Dynamic Duration
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="stocknews_min_duration">Min Duration</label><input type="number" class="form-control" id="stocknews_min_duration" value="{{ safe_config_get(main_config, 'stock_news', 'min_duration', default=30) }}"></div>
                                <div class="form-group"><label for="stocknews_max_duration">Max Duration</label><input type="number" class="form-control" id="stocknews_max_duration" value="{{ safe_config_get(main_config, 'stock_news', 'max_duration', default=300) }}"></div>
                                <div class="form-group"><label for="stocknews_duration_buffer">Duration Buffer</label><input type="number" step="0.01" class="form-control" id="stocknews_duration_buffer" value="{{ safe_config_get(main_config, 'stock_news', 'duration_buffer', default=0.1) }}"></div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Stock News</button>
                        </form>
                    </div>
                </div>

                <!-- Odds Ticker Tab -->
                <div id="odds" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Odds Ticker</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('odds_ticker')"><i class="fas fa-bolt"></i> On-Demand</button>
                                <button type="button" class="btn btn-secondary" onclick="stopOnDemand()"><i class="fas fa-ban"></i> Stop</button>
                            </div>
                        </div>
                        <form id="odds-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="odds_enabled" {% if safe_config_get(main_config, 'odds_ticker', 'enabled', default=True) %}checked{% endif %}>
                                    Enable Odds Ticker
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="odds_update_interval">Update Interval (sec)</label><input type="number" class="form-control" id="odds_update_interval" value="{{ safe_config_get(main_config, 'odds_ticker', 'update_interval', default=3600) }}"></div>
                                <div class="form-group"><label for="odds_scroll_speed">Scroll Speed</label><input type="number" step="0.1" class="form-control" id="odds_scroll_speed" value="{{ safe_config_get(main_config, 'odds_ticker', 'scroll_speed', default=1) }}"></div>
                                <div class="form-group"><label for="odds_scroll_delay">Scroll Delay (sec)</label><input type="number" step="0.001" class="form-control" id="odds_scroll_delay" value="{{ safe_config_get(main_config, 'odds_ticker', 'scroll_delay', default=0.01) }}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="odds_games_per_favorite_team">Games per Favorite Team</label><input type="number" class="form-control" id="odds_games_per_favorite_team" value="{{ safe_config_get(main_config, 'odds_ticker', 'games_per_favorite_team', default=1) }}"></div>
                                <div class="form-group"><label for="odds_max_games_per_league">Max Games per League</label><input type="number" class="form-control" id="odds_max_games_per_league" value="{{ safe_config_get(main_config, 'odds_ticker', 'max_games_per_league', default=5) }}"></div>
                                <div class="form-group"><label for="odds_future_fetch_days">Future Fetch Days</label><input type="number" class="form-control" id="odds_future_fetch_days" value="{{ safe_config_get(main_config, 'odds_ticker', 'future_fetch_days', default=50) }}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="odds_enabled_leagues">Enabled Leagues</label>
                                    <input type="text" class="form-control" id="odds_enabled_leagues" value="{{ safe_config_get(main_config, 'odds_ticker', 'enabled_leagues', default=['nfl', 'mlb', 'ncaa_fb', 'milb']) | join(', ') }}">
                                    <div class="description">Comma-separated list, e.g., nfl, mlb, ncaa_fb, milb</div>
                                </div>
                                <div class="form-group">
                                    <label for="odds_sort_order">Sort Order</label>
                                    <select id="odds_sort_order" class="form-control">
                                        <option value="soonest" {% if safe_config_get(main_config, 'odds_ticker', 'sort_order', default='soonest') == 'soonest' %}selected{% endif %}>Soonest</option>
                                        <option value="league" {% if safe_config_get(main_config, 'odds_ticker', 'sort_order', default='soonest') == 'league' %}selected{% endif %}>By League</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label><input type="checkbox" id="odds_show_favorite_teams_only" {% if safe_config_get(main_config, 'odds_ticker', 'show_favorite_teams_only', default=True) %}checked{% endif %}> Show Favorite Teams Only</label></div>
                                <div class="form-group"><label><input type="checkbox" id="odds_show_odds_only" {% if safe_config_get(main_config, 'odds_ticker', 'show_odds_only', default=False) %}checked{% endif %}> Show Odds Only</label></div>
                                <div class="form-group"><label><input type="checkbox" id="odds_loop" {% if safe_config_get(main_config, 'odds_ticker', 'loop', default=True) %}checked{% endif %}> Loop</label></div>
                                <div class="form-group"><label><input type="checkbox" id="odds_show_channel_logos" {% if safe_config_get(main_config, 'odds_ticker', 'show_channel_logos', default=True) %}checked{% endif %}> Show Channel Logos</label></div>
                            </div>
                            <div class="form-group"><label><input type="checkbox" id="odds_dynamic_duration" {% if safe_config_get(main_config, 'odds_ticker', 'dynamic_duration', default=True) %}checked{% endif %}> Dynamic Duration</label></div>
                            <div class="form-row">
                                <div class="form-group"><label for="odds_min_duration">Min Duration</label><input type="number" class="form-control" id="odds_min_duration" value="{{ safe_config_get(main_config, 'odds_ticker', 'min_duration', default=30) }}"></div>
                                <div class="form-group"><label for="odds_max_duration">Max Duration</label><input type="number" class="form-control" id="odds_max_duration" value="{{ safe_config_get(main_config, 'odds_ticker', 'max_duration', default=300) }}"></div>
                                <div class="form-group"><label for="odds_duration_buffer">Duration Buffer</label><input type="number" step="0.01" class="form-control" id="odds_duration_buffer" value="{{ safe_config_get(main_config, 'odds_ticker', 'duration_buffer', default=0.1) }}"></div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Odds Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Leaderboard Tab -->
                <div id="leaderboard" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Leaderboard Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('leaderboard')"><i class="fas fa-bolt"></i> On-Demand</button>
                                <button type="button" class="btn btn-secondary" onclick="stopOnDemand()"><i class="fas fa-ban"></i> Stop</button>
                            </div>
                        </div>
                        <form id="leaderboard-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Leaderboard
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="leaderboard_update_interval">Update Interval (sec)</label>
                                    <input type="number" class="form-control" id="leaderboard_update_interval" value="{{ safe_config_get(main_config, 'leaderboard', 'update_interval', default=3600) }}">
                                </div>
                                <div class="form-group">
                                    <label for="leaderboard_scroll_speed">Scroll Speed</label>
                                    <input type="number" step="0.1" class="form-control" id="leaderboard_scroll_speed" value="{{ safe_config_get(main_config, 'leaderboard', 'scroll_speed', default=1) }}">
                                </div>
                                <div class="form-group">
                                    <label for="leaderboard_scroll_delay">Scroll Delay (sec)</label>
                                    <input type="number" step="0.001" class="form-control" id="leaderboard_scroll_delay" value="{{ safe_config_get(main_config, 'leaderboard', 'scroll_delay', default=0.01) }}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="leaderboard_display_duration">Display Duration (sec)</label>
                                    <input type="number" class="form-control" id="leaderboard_display_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'display_duration', default=30) }}">
                                </div>
                                <div class="form-group">
                                    <label for="leaderboard_request_timeout">Request Timeout (sec)</label>
                                    <input type="number" class="form-control" id="leaderboard_request_timeout" value="{{ safe_config_get(main_config, 'leaderboard', 'request_timeout', default=10) }}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_loop" {% if safe_config_get(main_config, 'leaderboard', 'loop', default=True) %}checked{% endif %}>
                                    Loop
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_dynamic_duration" {% if safe_config_get(main_config, 'leaderboard', 'dynamic_duration', default=True) %}checked{% endif %}>
                                    Dynamic Duration
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="leaderboard_min_duration">Min Duration (sec)</label>
                                    <input type="number" class="form-control" id="leaderboard_min_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'min_duration', default=30) }}">
                                </div>
                                <div class="form-group">
                                    <label for="leaderboard_max_duration">Max Duration (sec)</label>
                                    <input type="number" class="form-control" id="leaderboard_max_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'max_duration', default=300) }}">
                                </div>
                                <div class="form-group">
                                    <label for="leaderboard_duration_buffer">Duration Buffer</label>
                                    <input type="number" step="0.01" class="form-control" id="leaderboard_duration_buffer" value="{{ safe_config_get(main_config, 'leaderboard', 'duration_buffer', default=0.1) }}">
                                </div>
                            </div>
                            
                            <h4>Enabled Sports</h4>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_nfl_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nfl', 'enabled', default=False) %}checked{% endif %}>
                                    NFL
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_nfl_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_nfl_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nfl', 'top_teams', default=10) }}" min="1" max="32">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_nba_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nba', 'enabled', default=False) %}checked{% endif %}>
                                    NBA
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_nba_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_nba_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nba', 'top_teams', default=10) }}" min="1" max="30">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_mlb_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'mlb', 'enabled', default=False) %}checked{% endif %}>
                                    MLB
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_mlb_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_mlb_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'mlb', 'top_teams', default=10) }}" min="1" max="30">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_ncaa_fb_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'enabled', default=False) %}checked{% endif %}>
                                    NCAA Football
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_ncaa_fb_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_ncaa_fb_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'top_teams', default=10) }}" min="1" max="25">
                                </div>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label>
                                        <input type="checkbox" id="leaderboard_ncaa_fb_show_ranking" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'show_ranking', default=True) %}checked{% endif %}>
                                        Show Ranking
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_nhl_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nhl', 'enabled', default=False) %}checked{% endif %}>
                                    NHL
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_nhl_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_nhl_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nhl', 'top_teams', default=10) }}" min="1" max="32">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="leaderboard_ncaam_basketball_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaam_basketball', 'enabled', default=False) %}checked{% endif %}>
                                    NCAA Men's Basketball
                                </label>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="leaderboard_ncaam_basketball_top_teams">Top Teams</label>
                                    <input type="number" class="form-control" id="leaderboard_ncaam_basketball_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaam_basketball', 'top_teams', default=10) }}" min="1" max="25">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Save Leaderboard Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Text Display Tab -->
                <div id="text" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Text Display</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('text_display')"><i class="fas fa-bolt"></i> On-Demand</button>
                            </div>
                        </div>
                        <form id="text-form">
                            <div class="form-group"><label><input type="checkbox" id="text_enabled" {% if safe_config_get(main_config, 'text_display', 'enabled', default=False) %}checked{% endif %}> Enable</label></div>
                            <div class="form-group"><label for="text_text">Text</label><input type="text" id="text_text" class="form-control" value="{{ safe_config_get(main_config, 'text_display', 'text', default='Subscribe to ChuckBuilds') }}"></div>
                            <div class="form-group"><label for="text_font_path">Font Path</label><input type="text" id="text_font_path" class="form-control" value="{{ safe_config_get(main_config, 'text_display', 'font_path', default='assets/fonts/press-start-2p.ttf') }}"></div>
                            <div class="form-row">
                                <div class="form-group"><label for="text_font_size">Font Size</label><input type="number" id="text_font_size" class="form-control" value="{{ safe_config_get(main_config, 'text_display', 'font_size', default=8) }}"></div>
                                <div class="form-group"><label><input type="checkbox" id="text_scroll" {% if safe_config_get(main_config, 'text_display', 'scroll', default=True) %}checked{% endif %}> Scroll</label></div>
                                <div class="form-group"><label for="text_scroll_speed">Scroll Speed</label><input type="number" id="text_scroll_speed" class="form-control" value="{{ safe_config_get(main_config, 'text_display', 'scroll_speed', default=40) }}"></div>
                                <div class="form-group"><label for="text_scroll_gap_width">Scroll Gap Width</label><input type="number" id="text_scroll_gap_width" class="form-control" value="{{ safe_config_get(main_config, 'text_display', 'scroll_gap_width', default=32) }}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="text_text_color">Text Color</label><input type="color" id="text_text_color" class="form-control" data-rgb='{{ safe_config_get(main_config, 'text_display', 'text_color', default=[255, 0, 0]) | tojson }}'></div>
                                <div class="form-group"><label for="text_background_color">Background Color</label><input type="color" id="text_background_color" class="form-control" data-rgb='{{ safe_config_get(main_config, 'text_display', 'background_color', default=[0, 0, 0]) | tojson }}'></div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Text Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Features Tab -->
                <div id="features" class="tab-content">
                    <div class="config-section">
                        <h3>Additional Features</h3>
                        <p>Configure additional features like clock, text display, and more.</p>
                        <!-- Features configuration will be populated by JavaScript -->
                        <div id="features-config">
                            Loading features configuration...
                        </div>
                    </div>
                </div>

                <!-- Of The Day Tab -->
                <div id="of_the_day" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Of The Day Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('of_the_day')"><i class="fas fa-bolt"></i> On-Demand</button>
                            </div>
                        </div>
                        <form id="of_the_day-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="of_the_day_enabled" {% if safe_config_get(main_config, 'of_the_day', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Of The Day
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="of_the_day_update_interval">Update Interval (sec)</label>
                                    <input type="number" class="form-control" id="of_the_day_update_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'update_interval', default=3600) }}">
                                </div>
                                <div class="form-group">
                                    <label for="of_the_day_display_rotate_interval">Display Rotate Interval (sec)</label>
                                    <input type="number" class="form-control" id="of_the_day_display_rotate_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'display_rotate_interval', default=20) }}">
                                </div>
                                <div class="form-group">
                                    <label for="of_the_day_subtitle_rotate_interval">Subtitle Rotate Interval (sec)</label>
                                    <input type="number" class="form-control" id="of_the_day_subtitle_rotate_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'subtitle_rotate_interval', default=10) }}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="of_the_day_category_order">Category Order</label>
                                <input type="text" class="form-control" id="of_the_day_category_order" value="{{ safe_config_get(main_config, 'of_the_day', 'category_order', default=['word_of_the_day', 'slovenian_word_of_the_day']) | join(', ') }}" placeholder="word_of_the_day, slovenian_word_of_the_day">
                                <div class="description">Comma-separated list of category keys in display order</div>
                            </div>
                            
                            <h4>Categories</h4>
                            <div class="form-group">
                                <h5>Word of the Day</h5>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label>
                                        <input type="checkbox" id="of_the_day_word_enabled" {% if safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'enabled', default=True) %}checked{% endif %}>
                                        Enable Word of the Day
                                    </label>
                                </div>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="of_the_day_word_data_file">Data File</label>
                                    <input type="text" class="form-control" id="of_the_day_word_data_file" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'data_file', default='of_the_day/word_of_the_day.json') }}">
                                </div>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="of_the_day_word_display_name">Display Name</label>
                                    <input type="text" class="form-control" id="of_the_day_word_display_name" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'display_name', default='Word of the Day') }}">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <h5>Slovenian Word of the Day</h5>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label>
                                        <input type="checkbox" id="of_the_day_slovenian_enabled" {% if safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'enabled', default=True) %}checked{% endif %}>
                                        Enable Slovenian Word of the Day
                                    </label>
                                </div>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="of_the_day_slovenian_data_file">Data File</label>
                                    <input type="text" class="form-control" id="of_the_day_slovenian_data_file" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'data_file', default='of_the_day/slovenian_word_of_the_day.json') }}">
                                </div>
                                <div class="form-group" style="margin-left: 20px;">
                                    <label for="of_the_day_slovenian_display_name">Display Name</label>
                                    <input type="text" class="form-control" id="of_the_day_slovenian_display_name" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'display_name', default='Slovenian Word of the Day') }}">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Save Of The Day Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Music Tab -->
                <div id="music" class="tab-content">
                    <div class="config-section">
                        <h3>Music Configuration</h3>
                        <form id="music-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="music_enabled" name="music_enabled" {% if safe_config_get(main_config, 'music', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Music Display
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="music_preferred_source">Preferred Source:</label>
                                <select class="form-control" id="music_preferred_source" name="music_preferred_source">
                                    <option value="ytm" {% if safe_config_get(main_config, 'music', 'preferred_source', default='ytm') == "ytm" %}selected{% endif %}>YouTube Music</option>
                                    <option value="spotify" {% if safe_config_get(main_config, 'music', 'preferred_source', default='ytm') == "spotify" %}selected{% endif %}>Spotify</option>
                                </select>
                                <div class="description">Primary music source to display</div>
                            </div>
                            <div class="form-group">
                                <label for="ytm_companion_url">YouTube Music Companion URL:</label>
                                <input type="text" class="form-control" id="ytm_companion_url" name="ytm_companion_url" value="{{ safe_config_get(main_config, 'music', 'YTM_COMPANION_URL', default='http://192.168.86.12:9863') }}">
                                <div class="description">URL for YouTube Music companion app</div>
                            </div>
                            <div class="form-group">
                                <label for="music_polling_interval">Polling Interval (seconds):</label>
                                <input type="number" class="form-control" id="music_polling_interval" name="music_polling_interval" value="{{ safe_config_get(main_config, 'music', 'POLLING_INTERVAL_SECONDS', default=1) }}" min="1" max="60">
                                <div class="description">How often to check for music updates</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Music Settings</button>
                        </form>
                    </div>
                </div>

                <!-- YouTube Tab -->
                <div id="youtube" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>YouTube</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('youtube')"><i class="fas fa-bolt"></i> On-Demand</button>
                            </div>
                        </div>
                        <form id="youtube-form">
                            <div class="form-group"><label><input type="checkbox" id="youtube_enabled" {% if safe_config_get(main_config, 'youtube', 'enabled', default=False) %}checked{% endif %}> Enable YouTube</label></div>
                            <div class="form-group"><label for="youtube_update_interval">Update Interval (sec)</label><input type="number" id="youtube_update_interval" class="form-control" value="{{ safe_config_get(main_config, 'youtube', 'update_interval', default=3600) }}"></div>
                            <button type="submit" class="btn btn-success">Save YouTube Settings</button>
                        </form>
                    </div>
                </div>

                <!-- Calendar Tab -->
                <div id="calendar" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>Calendar Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('calendar')"><i class="fas fa-bolt"></i> On-Demand</button>
                            </div>
                        </div>
                        <form id="calendar-form">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="calendar_enabled" name="calendar_enabled" {% if safe_config_get(main_config, 'calendar', 'enabled', default=False) %}checked{% endif %}>
                                    Enable Calendar
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="calendar_max_events">Max Events to Show:</label>
                                <input type="number" class="form-control" id="calendar_max_events" name="calendar_max_events" value="{{ safe_config_get(main_config, 'calendar', 'max_events', default=3) }}" min="1" max="10">
                                <div class="description">Maximum number of events to display</div>
                            </div>
                            <div class="form-group">
                                <label for="calendar_update_interval">Update Interval (seconds):</label>
                                <input type="number" class="form-control" id="calendar_update_interval" name="calendar_update_interval" value="{{ safe_config_get(main_config, 'calendar', 'update_interval', default=3600) }}" min="300" max="3600">
                                <div class="description">How often to update calendar data</div>
                            </div>
                            <div class="form-group">
                                <label for="calendar_calendars">Calendars:</label>
                                <input type="text" class="form-control" id="calendar_calendars" name="calendar_calendars" value="{{ safe_config_get(main_config, 'calendar', 'calendars', default=['birthdays'])|join(', ') }}" placeholder="birthdays, work">
                                <div class="description">Comma-separated calendar names</div>
                            </div>
                            <button type="submit" class="btn btn-success">Save Calendar Settings</button>
                        </form>
                    </div>
                </div>

                <!-- News Tab -->
                <div id="news" class="tab-content">
                    <div class="config-section">
                        <div style="display:flex; justify-content: space-between; align-items:center;">
                            <h3>News Manager Configuration</h3>
                            <div style="display:flex; gap:8px;">
                                <button type="button" class="btn btn-info" onclick="startOnDemand('news_manager')"><i class="fas fa-bolt"></i> On-Demand</button>
                            </div>
                        </div>
                        <p>Configure RSS news feeds and scrolling ticker settings</p>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="news_enabled" name="news_enabled">
                                Enable News Manager
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="headlines_per_feed">Headlines Per Feed:</label>
                            <input type="number" class="form-control" id="headlines_per_feed" name="headlines_per_feed" min="1" max="5" value="2">
                            <div class="description">Number of headlines to show from each enabled feed</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Available News Feeds:</label>
                            <div class="checkbox-grid" id="news_feeds_grid">
                                <!-- Feeds will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <h4>Custom RSS Feeds</h4>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <input type="text" class="form-control" id="custom_feed_name" placeholder="Feed Name" style="width: 200px;">
                                <input type="text" class="form-control" id="custom_feed_url" placeholder="RSS Feed URL" style="flex: 1;">
                                <button type="button" class="btn btn-primary" onclick="addCustomFeed()">Add Feed</button>
                            </div>
                            <div id="custom_feeds_list">
                                <!-- Custom feeds will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="rotation_enabled" name="rotation_enabled" checked>
                                Enable Headline Rotation
                            </label>
                            <div class="description">Rotate through different headlines to avoid repetition</div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-success" onclick="saveNewsSettings()">Save News Settings</button>
                            <button type="button" class="btn btn-primary" onclick="refreshNewsStatus()">Refresh Status</button>
                        </div>
                        
                        <div id="news_status" style="margin-top: 20px; padding: 15px; background: #f0f8f0; border-radius: var(--border-radius);">
                            <!-- Status will be populated by JavaScript -->
                        </div>

                        <h4 style="margin-top:20px;">Advanced Settings</h4>
                        <div class="form-row">
                            <div class="form-group"><label for="news_update_interval">Update Interval (sec)</label><input type="number" id="news_update_interval" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'update_interval', default=300) }}"></div>
                            <div class="form-group"><label for="news_scroll_speed">Scroll Speed</label><input type="number" step="0.1" id="news_scroll_speed" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'scroll_speed', default=1) }}"></div>
                            <div class="form-group"><label for="news_scroll_delay">Scroll Delay (sec)</label><input type="number" step="0.001" id="news_scroll_delay" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'scroll_delay', default=0.01) }}"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label for="news_rotation_threshold">Rotation Threshold</label><input type="number" id="news_rotation_threshold" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'rotation_threshold', default=3) }}"></div>
                            <div class="form-group"><label><input type="checkbox" id="news_dynamic_duration" {% if safe_config_get(main_config, 'news_manager', 'dynamic_duration', default=True) %}checked{% endif %}> Dynamic Duration</label></div>
                            <div class="form-group"><label for="news_min_duration">Min Duration</label><input type="number" id="news_min_duration" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'min_duration', default=30) }}"></div>
                            <div class="form-group"><label for="news_max_duration">Max Duration</label><input type="number" id="news_max_duration" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'max_duration', default=300) }}"></div>
                            <div class="form-group"><label for="news_duration_buffer">Duration Buffer</label><input type="number" step="0.01" id="news_duration_buffer" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'duration_buffer', default=0.1) }}"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label for="news_font_size">Font Size</label><input type="number" id="news_font_size" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'font_size', default=8) }}"></div>
                            <div class="form-group"><label for="news_font_path">Font Path</label><input type="text" id="news_font_path" class="form-control" value="{{ safe_config_get(main_config, 'news_manager', 'font_path', default='assets/fonts/PressStart2P-Regular.ttf') }}"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label for="news_text_color">Text Color</label><input type="color" id="news_text_color" class="form-control" data-rgb='{{ safe_config_get(main_config, 'news_manager', 'text_color', default=[255, 255, 255]) | tojson }}'></div>
                            <div class="form-group"><label for="news_separator_color">Separator Color</label><input type="color" id="news_separator_color" class="form-control" data-rgb='{{ safe_config_get(main_config, 'news_manager', 'separator_color', default=[255, 0, 0]) | tojson }}'></div>
                        </div>
                        <button class="btn btn-success" type="button" onclick="saveNewsAdvancedSettings()">Save Advanced News Settings</button>
                    </div>
                </div>

                <!-- API Keys Tab -->
                <div id="secrets" class="tab-content">
                    <div class="config-section">
                        <h3>API Keys Configuration</h3>
                        <p>Enter your API keys for various services. These are stored securely and not shared.</p>
                        
                        <form id="secrets-form">
                            <h4>Weather API</h4>
                            <div class="form-group">
                                <label for="weather_api_key">OpenWeatherMap API Key:</label>
                                <input type="password" class="form-control" id="weather_api_key" name="weather_api_key" value="{{ (secrets_config.weather.api_key if secrets_config and secrets_config.weather and secrets_config.weather.api_key != 'YOUR_OPENWEATHERMAP_API_KEY' else '') if secrets_config else '' }}" placeholder="Enter your OpenWeatherMap API key">
                                <div class="description">Get your free API key from <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a></div>
                            </div>

                            <h4>YouTube API</h4>
                            <div class="form-group">
                                <label for="youtube_api_key">YouTube API Key:</label>
                                <input type="password" class="form-control" id="youtube_api_key" name="youtube_api_key" value="{{ secrets_config.youtube.api_key if secrets_config.youtube.api_key != 'YOUR_YOUTUBE_API_KEY' else '' }}" placeholder="Enter your YouTube API key">
                                <div class="description">Get your API key from <a href="https://console.developers.google.com/" target="_blank">Google Cloud Console</a></div>
                            </div>

                            <h4>Spotify API</h4>
                            <div class="form-group">
                                <label for="spotify_client_id">Spotify Client ID:</label>
                                <input type="password" class="form-control" id="spotify_client_id" name="spotify_client_id" value="{{ secrets_config.music.SPOTIFY_CLIENT_ID if secrets_config.music.SPOTIFY_CLIENT_ID != 'YOUR_SPOTIFY_CLIENT_ID_HERE' else '' }}" placeholder="Enter your Spotify Client ID">
                                <div class="description">Get from <a href="https://developer.spotify.com/dashboard" target="_blank">Spotify Developer Dashboard</a></div>
                            </div>
                            <div class="form-group">
                                <label for="spotify_client_secret">Spotify Client Secret:</label>
                                <input type="password" class="form-control" id="spotify_client_secret" name="spotify_client_secret" value="{{ secrets_config.music.SPOTIFY_CLIENT_SECRET if secrets_config.music.SPOTIFY_CLIENT_SECRET != 'YOUR_SPOTIFY_CLIENT_SECRET_HERE' else '' }}" placeholder="Enter your Spotify Client Secret">
                                <div class="description">Your Spotify Client Secret</div>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Save API Keys</button>
                        </form>
                    </div>
                </div>

                <!-- Editor Tab -->
                <div id="editor" class="tab-content">
                    <h3>Display Editor</h3>
                    
                    <div class="element-palette">
                        <h4>Elements</h4>
                        <div class="palette-item" draggable="true" data-type="text">
                            <i class="fas fa-font"></i> Text
                        </div>
                        <div class="palette-item" draggable="true" data-type="weather_icon">
                            <i class="fas fa-cloud-sun"></i> Weather Icon
                        </div>
                        <div class="palette-item" draggable="true" data-type="rectangle">
                            <i class="fas fa-square"></i> Rectangle
                        </div>
                        <div class="palette-item" draggable="true" data-type="line">
                            <i class="fas fa-minus"></i> Line
                        </div>
                    </div>

                    <div class="editor-toolbar">
                        <button class="btn btn-primary" onclick="clearEditor()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button class="btn btn-success" onclick="saveLayout()">
                            <i class="fas fa-save"></i> Save Layout
                        </button>
                        <button class="btn btn-warning" onclick="loadLayout()">
                            <i class="fas fa-folder-open"></i> Load Layout
                        </button>
                    </div>

                    <div class="properties-panel">
                        <h4>Element Properties</h4>
                        <div id="elementProperties">
                            <p>Select an element to edit its properties</p>
                        </div>
                    </div>
                </div>

                <!-- Actions Tab -->
                <div id="actions" class="tab-content">
                    <div class="config-section">
                        <h3>System Actions</h3>
                        <p>Control the display service and system operations.</p>
                        
                        <h4>Display Control</h4>
                        <div class="display-controls">
                            <button type="button" class="btn btn-success" onclick="runAction('start_display')">
                                <i class="fas fa-play"></i> Start Display
                            </button>
                            <button type="button" class="btn btn-danger" onclick="runAction('stop_display')">
                                <i class="fas fa-stop"></i> Stop Display
                            </button>
                        </div>

                        <h4>Auto-Start Settings</h4>
                        <div class="display-controls">
                            <button type="button" class="btn btn-success" onclick="runAction('enable_autostart')">
                                <i class="fas fa-check"></i> Enable Auto-Start
                            </button>
                            <button type="button" class="btn btn-warning" onclick="runAction('disable_autostart')">
                                <i class="fas fa-times"></i> Disable Auto-Start
                            </button>
                        </div>

                        <h4>System Operations</h4>
                        <div class="display-controls">
                            <button type="button" class="btn btn-warning" onclick="runAction('git_pull')">
                                <i class="fas fa-download"></i> Download Latest Update
                            </button>
                            <button type="button" class="btn btn-danger" onclick="runAction('reboot_system')" onclick="return confirm('Are you sure you want to reboot?')">
                                <i class="fas fa-power-off"></i> Reboot System
                            </button>
                    <button type="button" class="btn btn-danger" onclick="confirmShutdown()">
                        <i class="fas fa-power-off"></i> Shutdown System
                    </button>
                        </div>

                        <h4>Action Output</h4>
                        <div style="margin-top: 20px;">
                            <pre id="action_output" style="background: #f5f5f5; padding: 15px; border-radius: var(--border-radius); min-height: 100px; white-space: pre-wrap;">No action run yet.</pre>
                        </div>
                    </div>
                </div>

                <!-- Raw JSON Tab -->
                <div id="raw-json" class="tab-content">
                    <div class="config-section">
                        <h3>Raw Configuration JSON</h3>
                        <p>View, edit, and save the complete configuration files directly. <strong>⚠️ Warning:</strong> Be careful when editing raw JSON - invalid syntax will prevent saving.</p>
                        
                        <h4>Main Configuration (config.json)</h4>
                        <div class="form-group">
                            <label>Configuration Path:</label>
                            <span>{{ main_config_path }}</span>
                        </div>
                        <div class="json-container">
                            <textarea id="main-config-json">{{ main_config_json }}</textarea>
                            <div id="main-config-status" class="json-status valid">VALID</div>
                            <div id="main-config-validation" class="json-validation"></div>
                        </div>
                        <div class="json-actions">
                            <button type="button" class="btn btn-primary" onclick="formatJson('main-config-json')">Format JSON</button>
                            <button type="button" class="btn btn-warning" onclick="validateJson('main-config-json', 'main-config-validation')">Validate JSON</button>
                            <button type="button" class="btn btn-success" onclick="saveRawJson('main')">Save Main Config</button>
                        </div>

                        <h4>Secrets Configuration (config_secrets.json)</h4>
                        <div class="form-group">
                            <label>Configuration Path:</label>
                            <span>{{ secrets_config_path }}</span>
                        </div>
                        <div class="json-container">
                            <textarea id="secrets-config-json">{{ secrets_config_json }}</textarea>
                            <div id="secrets-config-status" class="json-status valid">VALID</div>
                            <div id="secrets-config-validation" class="json-validation"></div>
                        </div>
                        <div class="json-actions">
                            <button type="button" class="btn btn-primary" onclick="formatJson('secrets-config-json')">Format JSON</button>
                            <button type="button" class="btn btn-warning" onclick="validateJson('secrets-config-json', 'secrets-config-validation')">Validate JSON</button>
                            <button type="button" class="btn btn-success" onclick="saveRawJson('secrets')">Save Secrets Config</button>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logs" class="tab-content">
                    <div class="config-section">
                        <h3>System Logs</h3>
                        <p>View logs for the LED matrix service. Useful for debugging.</p>
                        <button class="btn btn-primary" onclick="fetchLogs()">
                            <i class="fas fa-refresh"></i> Refresh Logs
                        </button>
                        <pre id="log-content" style="background-color: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: var(--border-radius); max-height: 600px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word; margin-top: 15px;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status disconnected">
        <i class="fas fa-wifi"></i> Disconnected
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Server-provided data for JS (avoids inline Jinja in JS) -->
    <script id="serverData" type="application/json">{{ {'main_config': main_config_data, 'editor_mode': editor_mode} | tojson }}</script>

    <!-- External JavaScript files (loaded in dependency order) -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/state.js"></script>
    <script src="/static/js/socket.js"></script>
    <script src="/static/js/display.js"></script>
    <script src="/static/js/tabs.js"></script>
    <script src="/static/js/actions.js"></script>
    <script src="/static/js/editor.js"></script>
    <script src="/static/js/news.js"></script>
    <script src="/static/js/sports.js"></script>
    <script src="/static/js/forms.js"></script>
    <script src="/static/js/app.js"></script>

    <script>
        // All JavaScript has been moved to external files in /static/js/
        // Files are loaded in dependency order above
        // Keeping this empty script block for potential inline customizations
    </script>
</body>
</html>