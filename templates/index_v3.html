<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100 dark:bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Matrix Control Panel</title>
    
    <!-- Tailwind CSS (compiled) -->
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <!-- Sortable.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Custom animations and transitions */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            }
            50% { 
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            }
        }
        
        .status-active-pulse {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        /* Notification styles handled inline */
        
        /* Sidebar layout styles */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* Ensure the main flex container takes full height */
        .main-layout {
            height: 100vh;
        }
        
        /* Sidebar scroll behavior */
        .sidebar-scroll {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-track {
            background: #f7fafc;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Tab button hover effects */
        .tab-btn {
            transition: all 0.2s ease;
        }
        
        .tab-btn:hover:not(.active) {
            background-color: #f8fafc;
            color: #374151;
        }
        
        /* Active tab styling */
        .tab-btn.active {
            background-color: #eff6ff;
            border-left-color: #3498db !important;
            color: #3498db !important;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 767px) {
            /* Ensure header stays on top */
            header {
                z-index: 9999 !important;
            }
            
            /* Show hamburger menu on mobile */
            #mobile-menu-button {
                display: block !important;
            }
            
            /* Mobile sidebar positioning */
            #sidebar {
                position: fixed !important;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 50;
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease-in-out;
            }
            
            #sidebar.sidebar-open {
                transform: translateX(0) !important;
            }
            
            /* Mobile content area */
            .main-content-mobile {
                margin-left: 0;
                width: 100%;
            }
            
            /* Hide scrollbar on mobile sidebar */
            #sidebar::-webkit-scrollbar {
                width: 0;
                background: transparent;
            }
            
            /* Show mobile overlay when needed */
            #mobile-overlay {
                z-index: 40;
            }
            
            #mobile-overlay.overlay-show {
                display: block !important;
            }
        }
        
        /* Desktop styles */
        @media (min-width: 768px) {
            /* Hide hamburger menu on desktop */
            #mobile-menu-button {
                display: none !important;
            }
            
            /* Desktop sidebar */
            #sidebar {
                position: relative !important;
                transform: translateX(0) !important;
                height: auto;
            }
            
            /* Hide mobile overlay on desktop */
            #mobile-overlay {
                display: none !important;
            }
        }
        
        /* LED Canvas styles */
        .led-canvas, .grid-overlay {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .display-image {
            image-rendering: pixelated;
        }
        
        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #3498db;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body class="h-full">
    <!-- header -->
    <header class="bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 backdrop-blur-sm border-b border-purple-500/30 relative" style="z-index: 9998;">
        <div class="flex justify-between items-center h-16 px-4 sm:px-6 lg:px-8">
            <div class="flex items-center">
                <!-- Mobile menu button -->
                <button id="mobile-menu-button" class="text-white hover:text-gray-300 mr-3 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 rounded p-1" style="display: none;">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <i class="fas fa-tv text-white text-2xl mr-3"></i>
                <h1 class="text-xl font-semibold text-white hidden lg:block">LED Matrix Control Panel</h1>
                <h1 class="text-lg font-semibold text-white lg:hidden">LED Matrix</h1>
            </div>
            
            <!-- System Status (Center) -->
            <div class="hidden md:flex items-center gap-2 lg:gap-3 flex-1 justify-center mx-4">
                <!-- Service Status -->
                <div class="flex items-center gap-2 px-3 lg:px-4 py-2 rounded-lg text-xs lg:text-sm font-semibold transition-all duration-200 shadow-lg backdrop-blur-sm border
                    {% if system_status.service_active %}
                        bg-emerald-500/90 hover:bg-emerald-400/90 text-white border-emerald-400/50 status-active-pulse
                    {% else %}
                        bg-rose-500/90 hover:bg-rose-400/90 text-white border-rose-400/50
                    {% endif %}">
                    <i class="fas fa-{{ 'play-circle' if system_status.service_active else 'stop-circle' }} text-base"></i>
                    <span class="hidden lg:inline">{{ 'Active' if system_status.service_active else 'Inactive' }}</span>
                    <span class="lg:hidden">{{ 'ON' if system_status.service_active else 'OFF' }}</span>
                </div>
                
                <!-- CPU Usage -->
                <div class="flex items-center gap-2 px-3 py-2 rounded-lg text-xs lg:text-sm font-semibold transition-all duration-200 shadow-md backdrop-blur-sm border
                    {% if system_status and system_status.cpu_percent and system_status.cpu_percent > 80 %}
                        bg-amber-500/80 hover:bg-amber-400/80 text-white border-amber-300/50
                    {% else %}
                        bg-white/15 hover:bg-white/25 text-white border-white/20
                    {% endif %}">
                    <i class="fas fa-microchip"></i>
                    <span class="hidden lg:inline">CPU</span>
                    <span class="font-bold">{{ system_status.cpu_percent if system_status and system_status.cpu_percent is defined else 0 }}%</span>
                </div>
                
                <!-- Memory Usage -->
                <div class="flex items-center gap-2 px-3 py-2 rounded-lg text-xs lg:text-sm font-semibold transition-all duration-200 shadow-md backdrop-blur-sm border
                    {% if system_status and system_status.memory_used_percent and system_status.memory_used_percent > 80 %}
                        bg-amber-500/80 hover:bg-amber-400/80 text-white border-amber-300/50
                    {% else %}
                        bg-white/15 hover:bg-white/25 text-white border-white/20
                    {% endif %}">
                    <i class="fas fa-memory"></i>
                    <span class="hidden lg:inline">RAM</span>
                    <span class="font-bold">{{ system_status.memory_used_percent if system_status and system_status.memory_used_percent is defined else 0 }}%</span>
                </div>
                
                <!-- Temperature -->
                <div class="flex items-center gap-2 px-3 py-2 rounded-lg text-xs lg:text-sm font-semibold transition-all duration-200 shadow-md backdrop-blur-sm border
                    {% if system_status and system_status.cpu_temp and system_status.cpu_temp > 70 %}
                        bg-orange-500/80 hover:bg-orange-400/80 text-white border-orange-300/50
                    {% else %}
                        bg-white/15 hover:bg-white/25 text-white border-white/20
                    {% endif %}">
                    <i class="fas fa-thermometer-half"></i>
                    <span class="font-bold">{{ system_status.cpu_temp if system_status and system_status.cpu_temp is defined else 0 }}°C</span>
                </div>
                
                <!-- Uptime -->
                <div class="hidden xl:flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-200 shadow-md backdrop-blur-sm border bg-white/15 hover:bg-white/25 text-white border-white/20">
                    <i class="fas fa-clock"></i>
                    <span>{{ system_status.uptime }}</span>
                </div>
            </div>
            
            <!-- Quick Controls Dropdown -->
            <div class="relative" style="z-index: 9999;">
                <button id="quickControlsBtn" class="hidden md:flex items-center px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/30">
                    <i class="fas fa-bolt mr-2"></i>
                    <span>Quick Controls</span>
                    <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                
                <!-- Dropdown Menu -->
                <div id="quickControlsDropdown" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200" style="z-index: 9999;">
                    <div class="py-2">
                        <button onclick="executeQuickAction('start_display')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center">
                            <i class="fas fa-play mr-3 text-green-600"></i>
                            Start Display
                        </button>
                        <button onclick="executeQuickAction('stop_display')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center">
                            <i class="fas fa-stop mr-3 text-red-600"></i>
                            Stop Display
                        </button>
                        <button onclick="executeQuickAction('restart_service')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center">
                            <i class="fas fa-redo mr-3 text-blue-600"></i>
                            Restart Service
                        </button>
                        <button onclick="executeQuickAction('git_pull')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 flex items-center">
                            <i class="fas fa-download mr-3 text-yellow-600"></i>
                            Update Code
                        </button>
                        <button onclick="executeQuickAction('migrate_config')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center">
                            <i class="fas fa-sync-alt mr-3 text-blue-600"></i>
                            Migrate Config
                        </button>
                        <button onclick="executeQuickAction('reboot_system')" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center">
                            <i class="fas fa-power-off mr-3 text-red-600"></i>
                            Reboot System
                        </button>
                        <button onclick="stopOnDemand()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-700 flex items-center">
                            <i class="fas fa-ban mr-3 text-gray-600"></i>
                            Stop On-Demand
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40" style="display: none;"></div>

    <!-- Main Container with Sidebar Layout -->
    <div class="flex h-screen bg-gray-100 main-layout">
        <!-- Sidebar Navigation -->
        <div id="sidebar" class="w-64 bg-white shadow-lg border-r border-gray-200 overflow-y-auto sidebar-scroll">
            <div class="p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Control Panel</h2>
                <nav class="space-y-1">
                    <button onclick="showTab('overview')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-tachometer-alt mr-2"></i>Overview
                    </button>
                    <button onclick="showTab('general')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-sliders-h mr-2"></i>General
                    </button>
                    <button onclick="showTab('schedule')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-calendar mr-2"></i>Schedule
                    </button>
                    <button onclick="showTab('display')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-cog mr-2"></i>Display
                    </button>
                    <button onclick="showTab('clock')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-clock mr-2"></i>Clock
                    </button>
                    <button onclick="showTab('durations')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-hourglass-half mr-2"></i>Durations
                    </button>
                    <button onclick="showTab('sports')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-football-ball mr-2"></i>Sports
                    </button>
                    <button onclick="showTab('weather')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-cloud-sun mr-2"></i>Weather
                    </button>
                    <button onclick="showTab('stocks')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-chart-line mr-2"></i>Stocks
                    </button>
                    <button onclick="showTab('stocknews')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-newspaper mr-2"></i>Stock News
                    </button>
                    <button onclick="showTab('odds')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-ticket-alt mr-2"></i>Odds
                    </button>
                    <button onclick="showTab('leaderboard')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-trophy mr-2"></i>Leaderboard
                    </button>
                    <button onclick="showTab('text')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-font mr-2"></i>Text
                    </button>
                    <button onclick="showTab('of_the_day')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-calendar-day mr-2"></i>Of The Day
                    </button>
                    <button onclick="showTab('music')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-music mr-2"></i>Music
                    </button>
                    <button onclick="showTab('calendar')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-calendar-alt mr-2"></i>Calendar
                    </button>
                    <button onclick="showTab('youtube')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fab fa-youtube mr-2"></i>YouTube
                    </button>
                    <button onclick="showTab('news')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-newspaper mr-2"></i>News
                    </button>
                    <button onclick="showTab('secrets')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-key mr-2"></i>API Keys
                    </button>
                    <button onclick="showTab('editor')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-paint-brush mr-2"></i>Editor
                    </button>
                    <button onclick="showTab('actions')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-tools mr-2"></i>Actions
                    </button>
                    <button onclick="showTab('raw-json')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-code mr-2"></i>Raw JSON
                    </button>
                    <button onclick="showTab('logs')" class="tab-btn w-full text-left px-3 py-2 font-medium text-sm border-l-4 border-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-r-lg">
                        <i class="fas fa-file-alt mr-2"></i>Logs
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-y-auto main-content-mobile">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 z-20">
        
        <!-- Editor Mode Banner -->
        {% if editor_mode %}
        <div class="bg-gradient-to-r from-purple-600 to-purple-800 rounded-lg shadow-lg p-6 mb-6 text-white">
            <h2 class="text-xl font-bold mb-2">
                <i class="fas fa-edit mr-2"></i>Display Editor Mode Active
            </h2>
            <p>Normal display operation is paused. Use the tools below to customize your display layout.</p>
        </div>
        {% endif %}

        <!-- Display Preview - Expanded Mode (Center) -->
        <div id="expandedPreview" class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-desktop mr-2"></i>Live Display Preview
                </h2>
                <button onclick="toggleDisplayPreviewMode()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-2 rounded-lg transition flex items-center gap-2" title="Minimize to corner">
                    <i class="fas fa-compress-arrows-alt"></i>
                    <span class="text-sm">Minimize</span>
                </button>
            </div>
            
            <div id="displayPreviewExpanded" class="bg-black rounded-lg p-6 min-h-[400px] flex items-center justify-center relative border-2 border-gray-700">
                <div id="previewStageExpanded" class="relative hidden">
                    <div id="previewMetaExpanded" class="absolute -top-7 left-0 text-gray-400 text-xs"></div>
                    <img id="displayImageExpanded" class="display-image border border-gray-600 rounded bg-gray-900" alt="LED Matrix Display">
                    <canvas id="ledCanvasExpanded" class="led-canvas hidden"></canvas>
                    <canvas id="gridOverlayExpanded" class="grid-overlay"></canvas>
                </div>
                <div id="displayPlaceholderExpanded" class="text-gray-500 text-lg">
                    <i class="fas fa-spinner fa-spin mr-2"></i>
                    Connecting to display...
                </div>
            </div>

            <div class="flex flex-wrap gap-3 mt-4">
                <button onclick="toggleEditorMode()" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition">
                    <i class="fas fa-edit mr-2"></i>
                    {{ 'Exit Editor' if editor_mode else 'Enter Editor' }}
                </button>
                <button onclick="takeScreenshot()" class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
                    <i class="fas fa-camera mr-2"></i>Screenshot
                </button>
                
                <div class="ml-auto flex flex-wrap gap-3 items-center">
                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-lg text-sm">
                        Scale
                        <input type="range" id="scaleRangeExpanded" min="2" max="16" value="8" class="mx-2">
                        <span id="scaleValueExpanded" class="font-semibold">8x</span>
                    </label>
                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-lg text-sm cursor-pointer">
                        <input type="checkbox" id="toggleGridExpanded" class="mr-2">
                        Show pixel grid
                    </label>
                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-lg text-sm cursor-pointer">
                        <input type="checkbox" id="toggleLedDotsExpanded" checked class="mr-2">
                        LED dot mode
                    </label>
                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-lg text-sm">
                        Dot fill
                        <input type="range" id="dotFillRangeExpanded" min="40" max="95" value="75" class="mx-2">
                        <span id="dotFillValueExpanded" class="font-semibold">75%</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- NEW: Floating Preview Container (Bottom Left) -->
        <div id="floatingPreview" class="fixed bottom-4 left-50 bg-white rounded-lg shadow-2xl z-50 transition-all duration-300 hidden" style="width: 420px; max-width: calc(100vw - 2rem);">
            <!-- Header with controls -->
            <div class="bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 text-white px-4 py-3 rounded-t-lg flex items-center justify-between cursor-move" id="previewHeader">
                <div class="flex items-center">
                    <i class="fas fa-desktop mr-2"></i>
                    <span class="font-semibold">Live Display Preview</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleDisplayPreviewMode()" class="hover:bg-white/20 p-1 rounded transition" title="Expand to center">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </button>
                    <button onclick="toggleFloatingPreview()" class="hover:bg-white/20 p-1 rounded transition" title="Collapse preview">
                        <i id="minimizeIcon" class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            
            <!-- Preview Content (collapsible) -->
            <div id="previewContent" class="p-4">
                <!-- Preview Container -->
                <div id="displayPreview" class="bg-black rounded-lg p-4 min-h-[300px] flex items-center justify-center relative border-2 border-gray-700">
                    <div id="previewStage" class="relative hidden">
                        <div id="previewMeta" class="absolute -top-7 left-0 text-gray-400 text-xs"></div>
                        <img id="displayImage" class="display-image border border-gray-600 rounded bg-gray-900" alt="LED Matrix Display">
                        <canvas id="ledCanvas" class="led-canvas hidden"></canvas>
                        <canvas id="gridOverlay" class="grid-overlay"></canvas>
                    </div>
                    <div id="displayPlaceholder" class="text-gray-500 text-sm">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        Connecting...
                    </div>
                </div>

                <!-- Display Controls -->
                <div class="flex flex-col gap-2 mt-3">
                    <div class="flex gap-2">
                        <button onclick="toggleEditorMode()" class="bg-warning hover:bg-yellow-600 text-white px-3 py-2 rounded text-sm transition flex-1">
                            <i class="fas fa-edit mr-1"></i>
                            {{ 'Exit Editor' if editor_mode else 'Editor' }}
                        </button>
                        <button onclick="takeScreenshot()" class="bg-secondary hover:bg-blue-600 text-white px-3 py-2 rounded text-sm transition flex-1">
                            <i class="fas fa-camera mr-1"></i>Screenshot
                        </button>
                    </div>
                    
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center bg-gray-100 px-3 py-2 rounded text-xs">
                            Scale
                            <input type="range" id="scaleRange" min="2" max="16" value="4" class="mx-2 flex-1">
                            <span id="scaleValue" class="font-semibold">8x</span>
                        </label>
                        <div class="flex gap-2">
                            <label class="flex items-center bg-gray-100 px-3 py-2 rounded text-xs cursor-pointer flex-1">
                                <input type="checkbox" id="toggleGrid" class="mr-2">
                                Grid
                            </label>
                            <label class="flex items-center bg-gray-100 px-3 py-2 rounded text-xs cursor-pointer flex-1">
                                <input type="checkbox" id="toggleLedDots" checked class="mr-2">
                                LED
                            </label>
                        </div>
                        <label class="flex items-center bg-gray-100 px-3 py-2 rounded text-xs">
                            Dot fill
                            <input type="range" id="dotFillRange" min="40" max="95" value="75" class="mx-2 flex-1">
                            <span id="dotFillValue" class="font-semibold">75%</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <!-- Tab Content Container -->
            <div class="tab-content-container max-h-[70vh] overflow-y-auto">
                
                <!-- Overview Tab -->
                <div id="overview" class="tab-content">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">System Overview</h3>
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ system_status.cpu_percent if system_status and system_status.cpu_percent is defined else 0 }}%</div>
                            <div class="text-sm text-gray-600 mt-1">CPU Usage</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ system_status.memory_used_percent if system_status and system_status.memory_used_percent is defined else 0 }}%</div>
                            <div class="text-sm text-gray-600 mt-1">Memory Usage</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ system_status.cpu_temp if system_status and system_status.cpu_temp is defined else 0 }}°C</div>
                            <div class="text-sm text-gray-600 mt-1">CPU Temp</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ main_config.get('display', {}).get('hardware', {}).get('brightness', 0) }}</div>
                            <div class="text-sm text-gray-600 mt-1">Brightness</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ main_config.get('display', {}).get('hardware', {}).get('cols', 0) }}x{{ main_config.get('display', {}).get('hardware', {}).get('rows', 0) }}</div>
                            <div class="text-sm text-gray-600 mt-1">Resolution</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">{{ system_status.disk_used_percent if system_status and system_status.disk_used_percent is defined else 0 }}%</div>
                            <div class="text-sm text-gray-600 mt-1">Disk Usage</div>
                        </div>
                    </div>

                    <!-- API Metrics -->
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-md font-bold text-gray-800">API Calls (<span id="api-window">24h</span> window)</h4>
                        <button onclick="updateApiMetrics()" class="bg-secondary hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-sync mr-1"></i>Refresh
                        </button>
                    </div>
                    <div id="api-metrics" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">-</div>
                            <div class="text-sm text-gray-600 mt-1">Weather</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">-</div>
                            <div class="text-sm text-gray-600 mt-1">Stocks</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">-</div>
                            <div class="text-sm text-gray-600 mt-1">Sports</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">-</div>
                            <div class="text-sm text-gray-600 mt-1">News</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-secondary">-</div>
                            <div class="text-sm text-gray-600 mt-1">Total</div>
                        </div>
                    </div>

                   
                </div>

                <!-- General Tab -->
                <div id="general" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">General Settings</h3>
                    <form id="general-form" class="space-y-4">
                        <div>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="web_display_autostart" name="web_display_autostart" {% if safe_config_get(main_config, 'web_display_autostart', default=True) %}checked{% endif %} class="mr-2">
                                <span class="font-medium">Web Display Autostart</span>
                            </label>
                            <p class="text-sm text-gray-600 mt-1">Start the web interface on boot for easier access.</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Timezone</label>
                            <input type="text" id="timezone" name="timezone" value="{{ safe_config_get(main_config, 'timezone', default='America/Chicago') }}" placeholder="e.g., America/Chicago" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">IANA timezone, affects time-based features and scheduling.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">City</label>
                                <input type="text" id="city" name="city" value="{{ safe_config_get(main_config, 'location', 'city', default='Dallas') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">State</label>
                                <input type="text" id="state" name="state" value="{{ safe_config_get(main_config, 'location', 'state', default='Texas') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Country</label>
                                <input type="text" id="country" name="country" value="{{ safe_config_get(main_config, 'location', 'country', default='US') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save General Settings
                        </button>
                    </form>
                </div>

                <!-- More tabs will follow... Due to size, I'll continue in the next part -->
                <!-- The remaining tabs (Schedule, Display, Clock, etc.) follow the same Tailwind styling pattern -->
                <!-- Each uses: bg-white rounded-lg, Tailwind form classes, consistent button styling -->
                
                <!-- Schedule Tab -->
                <div id="schedule" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Display Schedule</h3>
                    <p class="text-sm text-gray-600 mb-4">Set the time for the display to be active. A restart is needed for changes to take effect.</p>
                    
                    <form id="schedule-form" class="space-y-4">
                        <div>
                            <label class="block font-medium text-gray-700 mb-2">Enable Schedule:</label>
                            <div class="flex items-center gap-3">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="schedule_enabled" name="schedule_enabled" {% if schedule_config.enabled %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                                <span class="text-sm text-gray-600">Turn display on/off automatically</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Display On Time:</label>
                            <input type="time" id="start_time" name="start_time" value="{{ schedule_config.start_time }}" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Time when the display should turn on</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Display Off Time:</label>
                            <input type="time" id="end_time" name="end_time" value="{{ schedule_config.end_time }}" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Time when the display should turn off</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Schedule
                        </button>
                    </form>
                </div>
                
                <!-- Display Settings Tab -->
                <div id="display" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">LED Matrix Hardware Settings</h3>
                    
                    <form id="display-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Left Column -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Rows:</label>
                                    <input type="number" id="rows" name="rows" value="{{ safe_config_get(main_config, 'display', 'hardware', 'rows', default=32) }}" min="1" max="64" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Number of LED rows</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Columns:</label>
                                    <input type="number" id="cols" name="cols" value="{{ safe_config_get(main_config, 'display', 'hardware', 'cols', default=64) }}" min="1" max="128" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Number of LED columns</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Chain Length:</label>
                                    <input type="number" id="chain_length" name="chain_length" value="{{ safe_config_get(main_config, 'display', 'hardware', 'chain_length', default=2) }}" min="1" max="8" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Number of LED panels chained together</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Parallel:</label>
                                    <input type="number" id="parallel" name="parallel" value="{{ safe_config_get(main_config, 'display', 'hardware', 'parallel', default=1) }}" min="1" max="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Number of parallel chains</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Brightness:</label>
                                    <input type="range" id="brightness" name="brightness" value="{{ safe_config_get(main_config, 'display', 'hardware', 'brightness', default=95) }}" min="1" max="100" oninput="updateBrightnessDisplay(this.value)" class="w-full">
                                    <p class="text-sm text-gray-600 mt-1">LED brightness: <span id="brightness-value" class="font-semibold">{{ safe_config_get(main_config, 'display', 'hardware', 'brightness', default=95) }}</span>%</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Hardware Mapping:</label>
                                    <select id="hardware_mapping" name="hardware_mapping" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                        <option value="adafruit-hat-pwm" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "adafruit-hat-pwm" %}selected{% endif %}>Adafruit HAT PWM</option>
                                        <option value="adafruit-hat" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "adafruit-hat" %}selected{% endif %}>Adafruit HAT</option>
                                        <option value="regular" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "regular" %}selected{% endif %}>Regular</option>
                                        <option value="regular-pi1" {% if safe_config_get(main_config, 'display', 'hardware', 'hardware_mapping', default='adafruit-hat-pwm') == "regular-pi1" %}selected{% endif %}>Regular Pi1</option>
                                    </select>
                                    <p class="text-sm text-gray-600 mt-1">Hardware mapping type</p>
                                </div>
                            </div>
                            
                            <!-- Right Column -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">GPIO Slowdown:</label>
                                    <input type="number" id="gpio_slowdown" name="gpio_slowdown" value="{{ safe_config_get(main_config, 'display', 'runtime', 'gpio_slowdown', default=3) }}" min="0" max="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">GPIO slowdown factor (0-5)</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Scan Mode:</label>
                                    <input type="number" id="scan_mode" name="scan_mode" value="{{ safe_config_get(main_config, 'display', 'hardware', 'scan_mode', default=0) }}" min="0" max="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Scan mode for LED matrix (0-1)</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">PWM Bits:</label>
                                    <input type="number" id="pwm_bits" name="pwm_bits" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_bits', default=9) }}" min="1" max="11" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">PWM bits for brightness control (1-11)</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">PWM Dither Bits:</label>
                                    <input type="number" id="pwm_dither_bits" name="pwm_dither_bits" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_dither_bits', default=1) }}" min="0" max="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">PWM dither bits (0-4)</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">PWM LSB Nanoseconds:</label>
                                    <input type="number" id="pwm_lsb_nanoseconds" name="pwm_lsb_nanoseconds" value="{{ safe_config_get(main_config, 'display', 'hardware', 'pwm_lsb_nanoseconds', default=130) }}" min="50" max="500" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">PWM LSB nanoseconds (50-500)</p>
                                </div>
                                
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Limit Refresh Rate (Hz):</label>
                                    <input type="number" id="limit_refresh_rate_hz" name="limit_refresh_rate_hz" value="{{ safe_config_get(main_config, 'display', 'hardware', 'limit_refresh_rate_hz', default=120) }}" min="1" max="1000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <p class="text-sm text-gray-600 mt-1">Limit refresh rate in Hz (1-1000)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Checkboxes -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4 border-t">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="disable_hardware_pulsing" name="disable_hardware_pulsing" {% if safe_config_get(main_config, 'display', 'hardware', 'disable_hardware_pulsing', default=False) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Disable Hardware Pulsing</span>
                            </label>
                            
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="inverse_colors" name="inverse_colors" {% if safe_config_get(main_config, 'display', 'hardware', 'inverse_colors', default=False) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Inverse Colors</span>
                            </label>
                            
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="show_refresh_rate" name="show_refresh_rate" {% if safe_config_get(main_config, 'display', 'hardware', 'show_refresh_rate', default=False) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Show Refresh Rate</span>
                            </label>
                            
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="use_short_date_format" name="use_short_date_format" {% if safe_config_get(main_config, 'display', 'use_short_date_format', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Use Short Date Format</span>
                            </label>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Display Settings
                        </button>
                    </form>
                </div>

                <!-- Clock Tab -->
                <div id="clock" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Clock Configuration</h3>
                    
                    <form id="clock-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="clock_enabled" {% if safe_config_get(main_config, 'clock', 'enabled', default=True) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Clock</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Format</label>
                            <input type="text" id="clock_format" value="{{ safe_config_get(main_config, 'clock', 'format', default='%I:%M %p') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Python strftime format. Example: %I:%M %p for 12-hour time.</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (seconds)</label>
                            <input type="number" id="clock_update_interval" value="{{ safe_config_get(main_config, 'clock', 'update_interval', default=1) }}" min="1" max="60" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Clock Settings
                        </button>
                    </form>
                </div>

                <!-- Durations Tab -->
                <div id="durations" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Rotation Durations</h3>
                    <p class="text-sm text-gray-600 mb-4">How long each screen is shown before switching. Values in seconds.</p>
                    
                    <form id="durations-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            {% for key, value in main_config.get('display', {}).get('display_durations', {}).items() %}
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">{{ key | replace('_', ' ') | title }}</label>
                                <input type="number" id="duration_{{ key }}" data-name="{{ key }}" value="{{ value }}" min="5" max="600" class="duration-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            {% endfor %}
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Durations
                        </button>
                    </form>
                </div>

                <!-- Sports Tab -->
                <div id="sports" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Sports Configuration</h3>
                    <p class="text-sm text-gray-600 mb-4">Configure which sports leagues to display and their settings.</p>
                    
                    <div id="sports-config" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Loading sports configuration...</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-4">
                        <button type="button" onclick="refreshSportsConfig()" class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                        <button type="button" onclick="saveSportsConfig()" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-save mr-2"></i>Save Sports Settings
                        </button>
                    </div>
                </div>

                <!-- Weather Tab -->
                <div id="weather" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Weather Configuration</h3>
                        <div class="flex gap-2">
                            <button type="button" onclick="startOnDemand('weather_current')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-bolt mr-1"></i>Current
                            </button>
                            <button type="button" onclick="startOnDemand('weather_hourly')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-bolt mr-1"></i>Hourly
                            </button>
                            <button type="button" onclick="startOnDemand('weather_daily')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-bolt mr-1"></i>Daily
                            </button>
                        </div>
                    </div>
                    
                    <form id="weather-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="weather_enabled" name="weather_enabled" {% if safe_config_get(main_config, 'weather', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Weather</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">City:</label>
                            <input type="text" id="weather_city" name="weather_city" value="{{ safe_config_get(main_config, 'location', 'city', default='Dallas') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">City name for weather data</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">State:</label>
                            <input type="text" id="weather_state" name="weather_state" value="{{ safe_config_get(main_config, 'location', 'state', default='Texas') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">State/province name</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Units:</label>
                            <select id="weather_units" name="weather_units" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <option value="imperial" {% if safe_config_get(main_config, 'weather', 'units', default='imperial') == "imperial" %}selected{% endif %}>Fahrenheit</option>
                                <option value="metric" {% if safe_config_get(main_config, 'weather', 'units', default='imperial') == "metric" %}selected{% endif %}>Celsius</option>
                            </select>
                            <p class="text-sm text-gray-600 mt-1">Temperature units</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Display Format</label>
                            <textarea id="weather_display_format" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">{{ safe_config_get(main_config, 'weather', 'display_format', default='{temp}°F\n{condition}') }}</textarea>
                            <p class="text-sm text-gray-600 mt-1">Use tokens like {temp}, {condition}. Supports new lines.</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (seconds):</label>
                            <input type="number" id="weather_update_interval" name="weather_update_interval" value="{{ safe_config_get(main_config, 'weather', 'update_interval', default=1800) }}" min="300" max="3600" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">How often to update weather data (300-3600 seconds)</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Weather Settings
                        </button>
                    </form>
                </div>

                <!-- Stocks Tab -->
                <div id="stocks" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Stocks & Crypto Configuration</h3>
                        <button type="button" onclick="startOnDemand('stocks')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand Stocks
                        </button>
                    </div>
                    
                    <form id="stocks-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="stocks_enabled" name="stocks_enabled" {% if safe_config_get(main_config, 'stocks', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Stocks</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Stock Symbols:</label>
                            <input type="text" id="stocks_symbols" name="stocks_symbols" value="{{ safe_config_get(main_config, 'stocks', 'symbols', default=['ASTS', 'SCHD', 'INTC', 'NVDA', 'T', 'VOO', 'SMCI'])|join(', ') }}" placeholder="AAPL, GOOGL, MSFT" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Comma-separated stock symbols</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (seconds):</label>
                            <input type="number" id="stocks_update_interval" name="stocks_update_interval" value="{{ safe_config_get(main_config, 'stocks', 'update_interval', default=600) }}" min="60" max="3600" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">How often to update stock data</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" step="0.1" id="stocks_scroll_speed" value="{{ safe_config_get(main_config, 'stocks', 'scroll_speed', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <p class="text-sm text-gray-600 mt-1">Horizontal scroll pixels per step</p>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Delay (seconds)</label>
                                <input type="number" step="0.001" id="stocks_scroll_delay" value="{{ safe_config_get(main_config, 'stocks', 'scroll_delay', default=0.01) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <p class="text-sm text-gray-600 mt-1">Delay between scroll steps</p>
                            </div>
                        </div>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="stocks_toggle_chart" name="stocks_toggle_chart" {% if safe_config_get(main_config, 'stocks', 'toggle_chart', default=True) %}checked{% endif %} class="mr-2">
                            <span class="text-sm">Show Charts</span>
                        </label>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="stocks_dynamic_duration" {% if safe_config_get(main_config, 'stocks', 'dynamic_duration', default=True) %}checked{% endif %} class="mr-2">
                            <span class="text-sm">Dynamic Duration</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Min Duration (sec)</label>
                                <input type="number" id="stocks_min_duration" value="{{ safe_config_get(main_config, 'stocks', 'min_duration', default=30) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Duration (sec)</label>
                                <input type="number" id="stocks_max_duration" value="{{ safe_config_get(main_config, 'stocks', 'max_duration', default=300) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Duration Buffer</label>
                                <input type="number" step="0.01" id="stocks_duration_buffer" value="{{ safe_config_get(main_config, 'stocks', 'duration_buffer', default=0.1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Display Format</label>
                            <input type="text" id="stocks_display_format" value="{{ safe_config_get(main_config, 'stocks', 'display_format', default='{symbol}: ${price} ({change}%)') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Use tokens like {symbol}, {price}, {change}</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Stocks Settings
                        </button>
                    </form>

                    <h3 class="text-lg font-bold text-gray-800 mt-8 mb-4">Cryptocurrency</h3>
                    <form id="crypto-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="crypto_enabled" name="crypto_enabled" {% if safe_config_get(main_config, 'crypto', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Crypto</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Crypto Symbols:</label>
                            <input type="text" id="crypto_symbols" name="crypto_symbols" value="{{ safe_config_get(main_config, 'crypto', 'symbols', default=['BTC-USD', 'ETH-USD'])|join(', ') }}" placeholder="BTC-USD, ETH-USD" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Comma-separated crypto symbols (e.g., BTC-USD, ETH-USD)</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (seconds):</label>
                            <input type="number" id="crypto_update_interval" name="crypto_update_interval" value="{{ safe_config_get(main_config, 'crypto', 'update_interval', default=600) }}" min="60" max="3600" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">How often to update crypto data</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Crypto Settings
                        </button>
                    </form>
                </div>

                <!-- Stock News Tab -->
                <div id="stocknews" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Stock News</h3>
                        <button type="button" onclick="startOnDemand('stock_news')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand News
                        </button>
                    </div>
                    
                    <form id="stocknews-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="stocknews_enabled" {% if safe_config_get(main_config, 'stock_news', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Stock News</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                                <input type="number" id="stocknews_update_interval" value="{{ safe_config_get(main_config, 'stock_news', 'update_interval', default=3600) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" step="0.1" id="stocknews_scroll_speed" value="{{ safe_config_get(main_config, 'stock_news', 'scroll_speed', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Delay (sec)</label>
                                <input type="number" step="0.001" id="stocknews_scroll_delay" value="{{ safe_config_get(main_config, 'stock_news', 'scroll_delay', default=0.01) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Headlines per Symbol</label>
                                <input type="number" id="stocknews_max_headlines_per_symbol" value="{{ safe_config_get(main_config, 'stock_news', 'max_headlines_per_symbol', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Headlines per Rotation</label>
                                <input type="number" id="stocknews_headlines_per_rotation" value="{{ safe_config_get(main_config, 'stock_news', 'headlines_per_rotation', default=2) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="stocknews_dynamic_duration" {% if safe_config_get(main_config, 'stock_news', 'dynamic_duration', default=True) %}checked{% endif %} class="mr-2">
                            <span class="text-sm">Dynamic Duration</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Min Duration</label>
                                <input type="number" id="stocknews_min_duration" value="{{ safe_config_get(main_config, 'stock_news', 'min_duration', default=30) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Duration</label>
                                <input type="number" id="stocknews_max_duration" value="{{ safe_config_get(main_config, 'stock_news', 'max_duration', default=300) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Duration Buffer</label>
                                <input type="number" step="0.01" id="stocknews_duration_buffer" value="{{ safe_config_get(main_config, 'stock_news', 'duration_buffer', default=0.1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Stock News
                        </button>
                    </form>
                </div>

                <!-- Odds Ticker Tab -->
                <div id="odds" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Odds Ticker</h3>
                        <div class="flex gap-2">
                            <button type="button" onclick="startOnDemand('odds_ticker')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-bolt mr-1"></i>On-Demand
                            </button>
                            <button type="button" onclick="stopOnDemand()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-ban mr-1"></i>Stop
                            </button>
                        </div>
                    </div>
                    
                    <form id="odds-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="odds_enabled" {% if safe_config_get(main_config, 'odds_ticker', 'enabled', default=True) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Odds Ticker</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                                <input type="number" id="odds_update_interval" value="{{ safe_config_get(main_config, 'odds_ticker', 'update_interval', default=3600) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" step="0.1" id="odds_scroll_speed" value="{{ safe_config_get(main_config, 'odds_ticker', 'scroll_speed', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Delay (sec)</label>
                                <input type="number" step="0.001" id="odds_scroll_delay" value="{{ safe_config_get(main_config, 'odds_ticker', 'scroll_delay', default=0.01) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Games per Favorite Team</label>
                                <input type="number" id="odds_games_per_favorite_team" value="{{ safe_config_get(main_config, 'odds_ticker', 'games_per_favorite_team', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Games per League</label>
                                <input type="number" id="odds_max_games_per_league" value="{{ safe_config_get(main_config, 'odds_ticker', 'max_games_per_league', default=5) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Future Fetch Days</label>
                                <input type="number" id="odds_future_fetch_days" value="{{ safe_config_get(main_config, 'odds_ticker', 'future_fetch_days', default=50) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Enabled Leagues</label>
                                <input type="text" id="odds_enabled_leagues" value="{{ safe_config_get(main_config, 'odds_ticker', 'enabled_leagues', default=['nfl', 'mlb', 'ncaa_fb', 'milb']) | join(', ') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <p class="text-sm text-gray-600 mt-1">Comma-separated list, e.g., nfl, mlb, ncaa_fb, milb</p>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Sort Order</label>
                                <select id="odds_sort_order" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                    <option value="soonest" {% if safe_config_get(main_config, 'odds_ticker', 'sort_order', default='soonest') == 'soonest' %}selected{% endif %}>Soonest</option>
                                    <option value="league" {% if safe_config_get(main_config, 'odds_ticker', 'sort_order', default='soonest') == 'league' %}selected{% endif %}>By League</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="odds_show_favorite_teams_only" {% if safe_config_get(main_config, 'odds_ticker', 'show_favorite_teams_only', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Favorite Teams Only</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="odds_show_odds_only" {% if safe_config_get(main_config, 'odds_ticker', 'show_odds_only', default=False) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Show Odds Only</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="odds_loop" {% if safe_config_get(main_config, 'odds_ticker', 'loop', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Loop</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="odds_show_channel_logos" {% if safe_config_get(main_config, 'odds_ticker', 'show_channel_logos', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Show Channel Logos</span>
                            </label>
                        </div>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="odds_dynamic_duration" {% if safe_config_get(main_config, 'odds_ticker', 'dynamic_duration', default=True) %}checked{% endif %} class="mr-2">
                            <span class="text-sm">Dynamic Duration</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Min Duration</label>
                                <input type="number" id="odds_min_duration" value="{{ safe_config_get(main_config, 'odds_ticker', 'min_duration', default=30) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Duration</label>
                                <input type="number" id="odds_max_duration" value="{{ safe_config_get(main_config, 'odds_ticker', 'max_duration', default=300) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Duration Buffer</label>
                                <input type="number" step="0.01" id="odds_duration_buffer" value="{{ safe_config_get(main_config, 'odds_ticker', 'duration_buffer', default=0.1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Odds Settings
                        </button>
                    </form>
                </div>

                <!-- Leaderboard Tab -->
                <div id="leaderboard" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Leaderboard Configuration</h3>
                        <div class="flex gap-2">
                            <button type="button" onclick="startOnDemand('leaderboard')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-bolt mr-1"></i>On-Demand
                            </button>
                            <button type="button" onclick="stopOnDemand()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                                <i class="fas fa-ban mr-1"></i>Stop
                            </button>
                        </div>
                    </div>
                    
                    <form id="leaderboard-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="leaderboard_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Leaderboard</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                                <input type="number" id="leaderboard_update_interval" value="{{ safe_config_get(main_config, 'leaderboard', 'update_interval', default=3600) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" step="0.1" id="leaderboard_scroll_speed" value="{{ safe_config_get(main_config, 'leaderboard', 'scroll_speed', default=1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Delay (sec)</label>
                                <input type="number" step="0.001" id="leaderboard_scroll_delay" value="{{ safe_config_get(main_config, 'leaderboard', 'scroll_delay', default=0.01) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Display Duration (sec)</label>
                                <input type="number" id="leaderboard_display_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'display_duration', default=30) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Request Timeout (sec)</label>
                                <input type="number" id="leaderboard_request_timeout" value="{{ safe_config_get(main_config, 'leaderboard', 'request_timeout', default=10) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="flex gap-6">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="leaderboard_loop" {% if safe_config_get(main_config, 'leaderboard', 'loop', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Loop</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="leaderboard_dynamic_duration" {% if safe_config_get(main_config, 'leaderboard', 'dynamic_duration', default=True) %}checked{% endif %} class="mr-2">
                                <span class="text-sm">Dynamic Duration</span>
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Min Duration (sec)</label>
                                <input type="number" id="leaderboard_min_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'min_duration', default=30) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Max Duration (sec)</label>
                                <input type="number" id="leaderboard_max_duration" value="{{ safe_config_get(main_config, 'leaderboard', 'max_duration', default=300) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Duration Buffer</label>
                                <input type="number" step="0.01" id="leaderboard_duration_buffer" value="{{ safe_config_get(main_config, 'leaderboard', 'duration_buffer', default=0.1) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <h4 class="text-md font-bold text-gray-800 mt-6 mb-3">Enabled Sports</h4>
                        <div class="space-y-3 bg-gray-50 p-4 rounded-lg">
                            <div class="border-b pb-3">
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_nfl_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nfl', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>NFL</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                    <input type="number" id="leaderboard_nfl_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nfl', 'top_teams', default=10) }}" min="1" max="32" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            
                            <div class="border-b pb-3">
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_nba_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nba', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>NBA</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                    <input type="number" id="leaderboard_nba_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nba', 'top_teams', default=10) }}" min="1" max="30" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            
                            <div class="border-b pb-3">
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_mlb_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'mlb', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>MLB</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                    <input type="number" id="leaderboard_mlb_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'mlb', 'top_teams', default=10) }}" min="1" max="30" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            
                            <div class="border-b pb-3">
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_ncaa_fb_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>NCAA Football</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <div>
                                        <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                        <input type="number" id="leaderboard_ncaa_fb_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'top_teams', default=10) }}" min="1" max="25" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                    </div>
                                    <label class="flex items-center cursor-pointer text-sm">
                                        <input type="checkbox" id="leaderboard_ncaa_fb_show_ranking" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaa_fb', 'show_ranking', default=True) %}checked{% endif %} class="mr-2">
                                        <span>Show Ranking</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="border-b pb-3">
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_nhl_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nhl', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>NHL</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                    <input type="number" id="leaderboard_nhl_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'nhl', 'top_teams', default=10) }}" min="1" max="32" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            
                            <div>
                                <label class="flex items-center cursor-pointer font-medium mb-2">
                                    <input type="checkbox" id="leaderboard_ncaam_basketball_enabled" {% if safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaam_basketball', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                                    <span>NCAA Men's Basketball</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm text-gray-700 mb-1">Top Teams</label>
                                    <input type="number" id="leaderboard_ncaam_basketball_top_teams" value="{{ safe_config_get(main_config, 'leaderboard', 'enabled_sports', 'ncaam_basketball', 'top_teams', default=10) }}" min="1" max="25" class="w-32 px-3 py-1.5 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Leaderboard Settings
                        </button>
                    </form>
                </div>

                <!-- Text Display Tab -->
                <div id="text" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Text Display</h3>
                        <button type="button" onclick="startOnDemand('text_display')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand
                        </button>
                    </div>
                    
                    <form id="text-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="text_enabled" {% if safe_config_get(main_config, 'text_display', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Text Display</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Text</label>
                            <input type="text" id="text_text" value="{{ safe_config_get(main_config, 'text_display', 'text', default='Subscribe to ChuckBuilds') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Font Path</label>
                            <input type="text" id="text_font_path" value="{{ safe_config_get(main_config, 'text_display', 'font_path', default='assets/fonts/press-start-2p.ttf') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Font Size</label>
                                <input type="number" id="text_font_size" value="{{ safe_config_get(main_config, 'text_display', 'font_size', default=8) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="flex items-center cursor-pointer h-full items-end pb-2">
                                    <input type="checkbox" id="text_scroll" {% if safe_config_get(main_config, 'text_display', 'scroll', default=True) %}checked{% endif %} class="mr-2">
                                    <span class="text-sm">Scroll</span>
                                </label>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" id="text_scroll_speed" value="{{ safe_config_get(main_config, 'text_display', 'scroll_speed', default=40) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Scroll Gap Width</label>
                                <input type="number" id="text_scroll_gap_width" value="{{ safe_config_get(main_config, 'text_display', 'scroll_gap_width', default=32) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Text Color</label>
                                <input type="color" id="text_text_color" data-rgb='{{ safe_config_get(main_config, 'text_display', 'text_color', default=[255, 0, 0]) | tojson }}' class="w-full h-12 px-2 py-1 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Background Color</label>
                                <input type="color" id="text_background_color" data-rgb='{{ safe_config_get(main_config, 'text_display', 'background_color', default=[0, 0, 0]) | tojson }}' class="w-full h-12 px-2 py-1 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Text Settings
                        </button>
                    </form>
                </div>

                <!-- Of The Day Tab -->
                <div id="of_the_day" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Of The Day Configuration</h3>
                        <button type="button" onclick="startOnDemand('of_the_day')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand
                        </button>
                    </div>
                    
                    <form id="of_the_day-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="of_the_day_enabled" {% if safe_config_get(main_config, 'of_the_day', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Of The Day</span>
                        </label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                                <input type="number" id="of_the_day_update_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'update_interval', default=3600) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Display Rotate Interval (sec)</label>
                                <input type="number" id="of_the_day_display_rotate_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'display_rotate_interval', default=20) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">Subtitle Rotate Interval (sec)</label>
                                <input type="number" id="of_the_day_subtitle_rotate_interval" value="{{ safe_config_get(main_config, 'of_the_day', 'subtitle_rotate_interval', default=10) }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Category Order</label>
                            <input type="text" id="of_the_day_category_order" value="{{ safe_config_get(main_config, 'of_the_day', 'category_order', default=['word_of_the_day', 'slovenian_word_of_the_day']) | join(', ') }}" placeholder="word_of_the_day, slovenian_word_of_the_day" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Comma-separated list of category keys in display order</p>
                        </div>
                        
                        <h4 class="text-md font-bold text-gray-800 mt-6 mb-3">Categories</h4>
                        
                        <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                            <div class="border-b pb-4">
                                <h5 class="font-semibold text-gray-700 mb-3">Word of the Day</h5>
                                <div class="space-y-3 ml-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="of_the_day_word_enabled" {% if safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'enabled', default=True) %}checked{% endif %} class="mr-2">
                                        <span class="text-sm">Enable Word of the Day</span>
                                    </label>
                                    <div>
                                        <label class="block text-sm text-gray-700 mb-1">Data File</label>
                                        <input type="text" id="of_the_day_word_data_file" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'data_file', default='of_the_day/word_of_the_day.json') }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 mb-1">Display Name</label>
                                        <input type="text" id="of_the_day_word_display_name" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'word_of_the_day', 'display_name', default='Word of the Day') }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-3">Slovenian Word of the Day</h5>
                                <div class="space-y-3 ml-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="of_the_day_slovenian_enabled" {% if safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'enabled', default=True) %}checked{% endif %} class="mr-2">
                                        <span class="text-sm">Enable Slovenian Word of the Day</span>
                                    </label>
                                    <div>
                                        <label class="block text-sm text-gray-700 mb-1">Data File</label>
                                        <input type="text" id="of_the_day_slovenian_data_file" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'data_file', default='of_the_day/slovenian_word_of_the_day.json') }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 mb-1">Display Name</label>
                                        <input type="text" id="of_the_day_slovenian_display_name" value="{{ safe_config_get(main_config, 'of_the_day', 'categories', 'slovenian_word_of_the_day', 'display_name', default='Slovenian Word of the Day') }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Of The Day Settings
                        </button>
                    </form>
                </div>

                <!-- Music Tab -->
                <div id="music" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Music Configuration</h3>
                    
                    <form id="music-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="music_enabled" name="music_enabled" {% if safe_config_get(main_config, 'music', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Music Display</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Preferred Source:</label>
                            <select id="music_preferred_source" name="music_preferred_source" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <option value="ytm" {% if safe_config_get(main_config, 'music', 'preferred_source', default='ytm') == "ytm" %}selected{% endif %}>YouTube Music</option>
                                <option value="spotify" {% if safe_config_get(main_config, 'music', 'preferred_source', default='ytm') == "spotify" %}selected{% endif %}>Spotify</option>
                            </select>
                            <p class="text-sm text-gray-600 mt-1">Primary music source to display</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">YouTube Music Companion URL:</label>
                            <input type="text" id="ytm_companion_url" name="ytm_companion_url" value="{{ safe_config_get(main_config, 'music', 'YTM_COMPANION_URL', default='http://192.168.86.12:9863') }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">URL for YouTube Music companion app</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Polling Interval (seconds):</label>
                            <input type="number" id="music_polling_interval" name="music_polling_interval" value="{{ safe_config_get(main_config, 'music', 'POLLING_INTERVAL_SECONDS', default=1) }}" min="1" max="60" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">How often to check for music updates</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Music Settings
                        </button>
                    </form>
                </div>

                <!-- Calendar Tab -->
                <div id="calendar" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Calendar Configuration</h3>
                        <button type="button" onclick="startOnDemand('calendar')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand
                        </button>
                    </div>
                    
                    <form id="calendar-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="calendar_enabled" name="calendar_enabled" {% if safe_config_get(main_config, 'calendar', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable Calendar</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Max Events to Show:</label>
                            <input type="number" id="calendar_max_events" name="calendar_max_events" value="{{ safe_config_get(main_config, 'calendar', 'max_events', default=3) }}" min="1" max="10" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Maximum number of events to display</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (seconds):</label>
                            <input type="number" id="calendar_update_interval" name="calendar_update_interval" value="{{ safe_config_get(main_config, 'calendar', 'update_interval', default=3600) }}" min="300" max="3600" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">How often to update calendar data</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Calendars:</label>
                            <input type="text" id="calendar_calendars" name="calendar_calendars" value="{{ safe_config_get(main_config, 'calendar', 'calendars', default=['birthdays'])|join(', ') }}" placeholder="birthdays, work" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Comma-separated calendar names</p>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save Calendar Settings
                        </button>
                    </form>
                </div>

                <!-- YouTube Tab -->
                <div id="youtube" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">YouTube Configuration</h3>
                        <button type="button" onclick="startOnDemand('youtube')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand
                        </button>
                    </div>
                    
                    <form id="youtube-form" class="space-y-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="youtube_enabled" {% if safe_config_get(main_config, 'youtube', 'enabled', default=False) %}checked{% endif %} class="mr-2">
                            <span class="font-medium">Enable YouTube</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                            <input type="number" id="youtube_update_interval" value="{{ safe_config_get(main_config, 'youtube', 'update_interval', default=3600) }}" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save YouTube Settings
                        </button>
                    </form>
                </div>

                <!-- News Manager Tab -->
                <div id="news" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">News Manager Configuration</h3>
                        <button type="button" onclick="startOnDemand('news_manager')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition text-sm">
                            <i class="fas fa-bolt mr-1"></i>On-Demand
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">Configure RSS news feeds and scrolling ticker settings</p>
                    
                    <div class="space-y-4 mb-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="news_enabled" name="news_enabled" class="mr-2">
                            <span class="font-medium">Enable News Manager</span>
                        </label>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-1">Headlines Per Feed:</label>
                            <input type="number" id="headlines_per_feed" name="headlines_per_feed" min="1" max="5" value="2" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-1">Number of headlines to show from each enabled feed</p>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 mb-2">Available News Feeds:</label>
                            <div id="news_feeds_grid" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <!-- Feeds will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Custom RSS Feeds</h4>
                            <div class="flex gap-2 mb-3">
                                <input type="text" id="custom_feed_name" placeholder="Feed Name" class="w-48 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="text" id="custom_feed_url" placeholder="RSS Feed URL" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <button type="button" onclick="addCustomFeed()" class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Add Feed
                                </button>
                            </div>
                            <div id="custom_feeds_list" class="space-y-2">
                                <!-- Custom feeds will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="rotation_enabled" name="rotation_enabled" checked class="mr-2">
                            <span class="text-sm">Enable Headline Rotation</span>
                            <span class="text-xs text-gray-500 ml-2">Rotate through different headlines to avoid repetition</span>
                        </label>
                        
                        <div class="flex gap-3">
                            <button type="button" onclick="saveNewsSettings()" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                                Save News Settings
                            </button>
                            <button type="button" onclick="refreshNewsStatus()" class="bg-secondary hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition">
                                Refresh Status
                            </button>
                        </div>
                        
                        <div id="news_status" class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <!-- Status will be populated by JavaScript -->
                        </div>
                    </div>

                    <h4 class="text-md font-bold text-gray-800 mb-3 mt-6">Advanced Settings</h4>
                    <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Update Interval (sec)</label>
                                <input type="number" id="news_update_interval" value="{{ safe_config_get(main_config, 'news_manager', 'update_interval', default=300) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scroll Speed</label>
                                <input type="number" step="0.1" id="news_scroll_speed" value="{{ safe_config_get(main_config, 'news_manager', 'scroll_speed', default=1) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scroll Delay (sec)</label>
                                <input type="number" step="0.001" id="news_scroll_delay" value="{{ safe_config_get(main_config, 'news_manager', 'scroll_delay', default=0.01) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Rotation Threshold</label>
                                <input type="number" id="news_rotation_threshold" value="{{ safe_config_get(main_config, 'news_manager', 'rotation_threshold', default=3) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="flex items-center cursor-pointer h-full items-end pb-2">
                                    <input type="checkbox" id="news_dynamic_duration" {% if safe_config_get(main_config, 'news_manager', 'dynamic_duration', default=True) %}checked{% endif %} class="mr-2">
                                    <span class="text-xs">Dynamic Duration</span>
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Min Duration</label>
                                <input type="number" id="news_min_duration" value="{{ safe_config_get(main_config, 'news_manager', 'min_duration', default=30) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Max Duration</label>
                                <input type="number" id="news_max_duration" value="{{ safe_config_get(main_config, 'news_manager', 'max_duration', default=300) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Duration Buffer</label>
                                <input type="number" step="0.01" id="news_duration_buffer" value="{{ safe_config_get(main_config, 'news_manager', 'duration_buffer', default=0.1) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Font Size</label>
                                <input type="number" id="news_font_size" value="{{ safe_config_get(main_config, 'news_manager', 'font_size', default=8) }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Font Path</label>
                                <input type="text" id="news_font_path" value="{{ safe_config_get(main_config, 'news_manager', 'font_path', default='assets/fonts/PressStart2P-Regular.ttf') }}" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Text Color</label>
                                <input type="color" id="news_text_color" data-rgb='{{ safe_config_get(main_config, 'news_manager', 'text_color', default=[255, 255, 255]) | tojson }}' class="w-full h-10 px-2 py-1 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Separator Color</label>
                                <input type="color" id="news_separator_color" data-rgb='{{ safe_config_get(main_config, 'news_manager', 'separator_color', default=[255, 0, 0]) | tojson }}' class="w-full h-10 px-2 py-1 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                        
                        <button class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition" type="button" onclick="saveNewsAdvancedSettings()">
                            Save Advanced News Settings
                        </button>
                    </div>
                </div>

                <!-- API Keys (Secrets) Tab -->
                <div id="secrets" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">API Keys Configuration</h3>
                    <p class="text-sm text-gray-600 mb-4">Enter your API keys for various services. These are stored securely and not shared.</p>
                    
                    <form id="secrets-form" class="space-y-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-3">Weather API</h4>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">OpenWeatherMap API Key:</label>
                                <input type="password" id="weather_api_key" name="weather_api_key" value="{{ (secrets_config.weather.api_key if secrets_config and secrets_config.weather and secrets_config.weather.api_key != 'YOUR_OPENWEATHERMAP_API_KEY' else '') if secrets_config else '' }}" placeholder="Enter your OpenWeatherMap API key" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <p class="text-sm text-gray-600 mt-1">Get your free API key from <a href="https://openweathermap.org/api" target="_blank" class="text-secondary hover:underline">OpenWeatherMap</a></p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-3">YouTube API</h4>
                            <div>
                                <label class="block font-medium text-gray-700 mb-1">YouTube API Key:</label>
                                <input type="password" id="youtube_api_key" name="youtube_api_key" value="{{ secrets_config.youtube.api_key if secrets_config.youtube.api_key != 'YOUR_YOUTUBE_API_KEY' else '' }}" placeholder="Enter your YouTube API key" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                <p class="text-sm text-gray-600 mt-1">Get your API key from <a href="https://console.developers.google.com/" target="_blank" class="text-secondary hover:underline">Google Cloud Console</a></p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-3">Spotify API</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Spotify Client ID:</label>
                                    <input type="password" id="spotify_client_id" name="spotify_client_id" value="{{ secrets_config.music.SPOTIFY_CLIENT_ID if secrets_config.music.SPOTIFY_CLIENT_ID != 'YOUR_SPOTIFY_CLIENT_ID_HERE' else '' }}" placeholder="Enter your Spotify Client ID" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block font-medium text-gray-700 mb-1">Spotify Client Secret:</label>
                                    <input type="password" id="spotify_client_secret" name="spotify_client_secret" value="{{ secrets_config.music.SPOTIFY_CLIENT_SECRET if secrets_config.music.SPOTIFY_CLIENT_SECRET != 'YOUR_SPOTIFY_CLIENT_SECRET_HERE' else '' }}" placeholder="Enter your Spotify Client Secret" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent">
                                </div>
                                <p class="text-sm text-gray-600">Get from <a href="https://developer.spotify.com/dashboard" target="_blank" class="text-secondary hover:underline">Spotify Developer Dashboard</a></p>
                            </div>
                        </div>
                        
                        <button type="submit" class="bg-success hover:bg-green-600 text-white px-6 py-2 rounded-lg transition">
                            Save API Keys
                        </button>
                    </form>
                </div>

                <!-- Editor Tab -->
                <div id="editor" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Display Editor</h3>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3">Elements</h4>
                        <div class="flex flex-wrap gap-3">
                            <div class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer transition" draggable="true" data-type="text">
                                <i class="fas fa-font mr-2"></i>Text
                            </div>
                            <div class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer transition" draggable="true" data-type="weather_icon">
                                <i class="fas fa-cloud-sun mr-2"></i>Weather Icon
                            </div>
                            <div class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer transition" draggable="true" data-type="rectangle">
                                <i class="fas fa-square mr-2"></i>Rectangle
                            </div>
                            <div class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer transition" draggable="true" data-type="line">
                                <i class="fas fa-minus mr-2"></i>Line
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3 mb-6">
                        <button onclick="clearEditor()" class="bg-accent hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-trash mr-2"></i>Clear
                        </button>
                        <button onclick="saveLayout()" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-save mr-2"></i>Save Layout
                        </button>
                        <button onclick="loadLayout()" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition">
                            <i class="fas fa-folder-open mr-2"></i>Load Layout
                        </button>
                    </div>

                    <div class="bg-white border border-gray-300 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Element Properties</h4>
                        <div id="elementProperties" class="text-gray-600">
                            <p>Select an element to edit its properties</p>
                        </div>
                    </div>
                </div>

                <!-- Actions Tab -->
                <div id="actions" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">System Actions</h3>
                    <p class="text-sm text-gray-600 mb-6">Control the display service and system operations.</p>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Display Control</h4>
                            <div class="flex flex-wrap gap-3">
                                <button type="button" onclick="runAction('start_display')" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-play mr-2"></i>Start Display
                                </button>
                                <button type="button" onclick="runAction('stop_display')" class="bg-accent hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-stop mr-2"></i>Stop Display
                                </button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Auto-Start Settings</h4>
                            <div class="flex flex-wrap gap-3">
                                <button type="button" onclick="runAction('enable_autostart')" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-check mr-2"></i>Enable Auto-Start
                                </button>
                                <button type="button" onclick="runAction('disable_autostart')" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-times mr-2"></i>Disable Auto-Start
                                </button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">System Operations</h4>
                            <div class="flex flex-wrap gap-3">
                                <button type="button" onclick="runAction('git_pull')" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-download mr-2"></i>Download Latest Update
                                </button>
                                <button type="button" onclick="runAction('reboot_system')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-power-off mr-2"></i>Reboot System
                                </button>
                                <button type="button" onclick="confirmShutdown()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-power-off mr-2"></i>Shutdown System
                                </button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">Action Output</h4>
                            <pre id="action_output" class="bg-gray-50 border border-gray-300 rounded-lg p-4 min-h-[100px] whitespace-pre-wrap text-sm">No action run yet.</pre>
                        </div>
                    </div>
                </div>

                <!-- Raw JSON Editor Tab -->
                <div id="raw-json" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Raw Configuration JSON</h3>
                    <p class="text-sm text-gray-600 mb-4">View, edit, and save the complete configuration files directly. <strong class="text-accent">⚠️ Warning:</strong> Be careful when editing raw JSON - invalid syntax will prevent saving.</p>
                    
                    <div class="space-y-6">
                        <!-- Main Config -->
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Main Configuration (config.json)</h4>
                            <div class="mb-2">
                                <label class="text-sm text-gray-600">Configuration Path:</label>
                                <span class="text-sm font-mono text-gray-800 ml-2">{{ main_config_path }}</span>
                            </div>
                            
                            <div class="relative">
                                <textarea id="main-config-json" class="w-full min-h-[300px] p-4 border-2 border-gray-300 rounded-lg font-mono text-xs leading-relaxed focus:border-secondary focus:ring-2 focus:ring-secondary/20 transition">{{ main_config_json }}</textarea>
                                <div id="main-config-status" class="absolute top-3 right-3 px-2 py-1 rounded text-xs font-bold text-white bg-success">VALID</div>
                                <div id="main-config-validation" class="mt-2 p-3 rounded-lg text-sm font-mono hidden"></div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3 mt-3">
                                <button type="button" onclick="formatJson('main-config-json')" class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Format JSON
                                </button>
                                <button type="button" onclick="validateJson('main-config-json', 'main-config-validation')" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Validate JSON
                                </button>
                                <button type="button" onclick="saveRawJson('main')" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Save Main Config
                                </button>
                            </div>
                        </div>

                        <!-- Secrets Config -->
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-2">Secrets Configuration (config_secrets.json)</h4>
                            <div class="mb-2">
                                <label class="text-sm text-gray-600">Configuration Path:</label>
                                <span class="text-sm font-mono text-gray-800 ml-2">{{ secrets_config_path }}</span>
                            </div>
                            
                            <div class="relative">
                                <textarea id="secrets-config-json" class="w-full min-h-[300px] p-4 border-2 border-gray-300 rounded-lg font-mono text-xs leading-relaxed focus:border-secondary focus:ring-2 focus:ring-secondary/20 transition">{{ secrets_config_json }}</textarea>
                                <div id="secrets-config-status" class="absolute top-3 right-3 px-2 py-1 rounded text-xs font-bold text-white bg-success">VALID</div>
                                <div id="secrets-config-validation" class="mt-2 p-3 rounded-lg text-sm font-mono hidden"></div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3 mt-3">
                                <button type="button" onclick="formatJson('secrets-config-json')" class="bg-secondary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Format JSON
                                </button>
                                <button type="button" onclick="validateJson('secrets-config-json', 'secrets-config-validation')" class="bg-warning hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Validate JSON
                                </button>
                                <button type="button" onclick="saveRawJson('secrets')" class="bg-success hover:bg-green-600 text-white px-4 py-2 rounded-lg transition text-sm">
                                    Save Secrets Config
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logs" class="tab-content hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">System Logs</h3>
                    <p class="text-sm text-gray-600 mb-4">View logs for the LED matrix service. Useful for debugging.</p>
                    
                    <button onclick="fetchLogs()" class="bg-secondary hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition mb-4">
                        <i class="fas fa-sync mr-2"></i>Refresh Logs
                    </button>
                    
                    <pre id="log-content" class="bg-gray-900 text-green-400 p-4 rounded-lg max-h-[600px] overflow-y-auto whitespace-pre-wrap break-words text-sm font-mono">Loading logs...</pre>
                </div>

                
            </div>
        </div>
    </div>

    <!-- Connection Status (Fixed) -->
    <div id="connectionStatus" class="fixed bottom-6 right-6 px-4 py-2 rounded-full shadow-lg text-white text-sm font-medium bg-red-500" style="z-index: 10000;">
        <i class="fas fa-wifi mr-2"></i>Disconnected
    </div>

    <!-- Notification (Fixed) -->
    <div id="notification" class="px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300" style="position: fixed; top: 5rem; right: 1rem; z-index: 10000; opacity: 0; transform: translateX(calc(100% + 2rem));"></div>

    <!-- Server Data -->
    <script id="serverData" type="application/json">{{ {'main_config': main_config_data, 'editor_mode': editor_mode} | tojson }}</script>

    <!-- External JavaScript with all v2 functions -->
    <script src="/static/js/v3-functions.js"></script>
    <script src="/static/js/forms.js"></script>

    <!-- Main JavaScript -->
    <script>
        // All the JavaScript from index_v2.html would go here
        // This includes: socket initialization, tab switching, form handlers, etc.
        // Keeping it exactly as is to maintain functionality
        
        let socket;
        const __serverDataEl = document.getElementById('serverData');
        const __serverData = __serverDataEl ? JSON.parse(__serverDataEl.textContent) : { main_config: {}, editor_mode: false };
        let currentConfig = __serverData.main_config || {};
        let editorMode = !!__serverData.editor_mode;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            initializeEditor();
            initializeForms();
            updateSystemStats();
            loadNewsManagerData();
            updateApiMetrics();
            refreshOnDemandStatus();
            
            // Setup display preview controls
            const scaleRange = document.getElementById('scaleRange');
            const scaleValue = document.getElementById('scaleValue');
            const toggleGrid = document.getElementById('toggleGrid');
            const gridCanvas = document.getElementById('gridOverlay');
            const toggleLedDots = document.getElementById('toggleLedDots');
            const dotFillRange = document.getElementById('dotFillRange');
            const dotFillValue = document.getElementById('dotFillValue');
            
            if (scaleRange && scaleValue) {
                scaleRange.addEventListener('input', () => {
                    scaleValue.textContent = `${scaleRange.value}x`;
                    fetch('/api/display/current')
                        .then(r => r.json())
                        .then(data => {
                            if (!data || !data.width || !data.height) return;
                            const img = document.getElementById('displayImage');
                            const scale = parseInt(scaleRange.value || '8');
                            const width = data.width * scale;
                            const height = data.height * scale;
                            img.style.width = `${width}px`;
                            img.style.height = `${height}px`;
                            gridCanvas.width = width;
                            gridCanvas.height = height;
                            const ledCanvas = document.getElementById('ledCanvas');
                            ledCanvas.width = width;
                            ledCanvas.height = height;
                            drawGrid(gridCanvas, data.width, data.height, scale);
                            renderLedDots();
                        })
                        .catch(() => {});
                });
            }

            if (toggleGrid && gridCanvas) {
                toggleGrid.addEventListener('change', () => {
                    gridCanvas.style.display = toggleGrid.checked ? 'block' : 'none';
                    if (toggleGrid.checked) {
                        fetch('/api/display/current')
                            .then(r => r.json())
                            .then(data => {
                                if (!data || !data.width || !data.height) return;
                                const scale = parseInt((document.getElementById('scaleRange')?.value) || '8');
                                drawGrid(gridCanvas, data.width, data.height, scale);
                            })
                            .catch(() => {});
                    }
                });
                gridCanvas.style.display = 'none';
            }

            if (dotFillRange && dotFillValue) {
                dotFillRange.addEventListener('input', () => {
                    dotFillValue.textContent = `${dotFillRange.value}%`;
                    renderLedDots();
                });
            }
            
            if (toggleLedDots) {
                toggleLedDots.addEventListener('change', renderLedDots);
                if (toggleLedDots.checked) {
                    setTimeout(renderLedDots, 200);
                }
            }
            
            // Setup expanded display preview controls
            const scaleRangeExpanded = document.getElementById('scaleRangeExpanded');
            const scaleValueExpanded = document.getElementById('scaleValueExpanded');
            const toggleGridExpanded = document.getElementById('toggleGridExpanded');
            const gridCanvasExpanded = document.getElementById('gridOverlayExpanded');
            const toggleLedDotsExpanded = document.getElementById('toggleLedDotsExpanded');
            const dotFillRangeExpanded = document.getElementById('dotFillRangeExpanded');
            const dotFillValueExpanded = document.getElementById('dotFillValueExpanded');
            
            if (scaleRangeExpanded && scaleValueExpanded) {
                scaleRangeExpanded.addEventListener('input', () => {
                    scaleValueExpanded.textContent = `${scaleRangeExpanded.value}x`;
                    fetch('/api/display/current')
                        .then(r => r.json())
                        .then(data => {
                            if (!data || !data.width || !data.height) return;
                            const img = document.getElementById('displayImageExpanded');
                            const scale = parseInt(scaleRangeExpanded.value || '8');
                            const width = data.width * scale;
                            const height = data.height * scale;
                            img.style.width = `${width}px`;
                            img.style.height = `${height}px`;
                            gridCanvasExpanded.width = width;
                            gridCanvasExpanded.height = height;
                            const ledCanvas = document.getElementById('ledCanvasExpanded');
                            ledCanvas.width = width;
                            ledCanvas.height = height;
                            drawGrid(gridCanvasExpanded, data.width, data.height, scale, 'Expanded');
                            renderLedDots('Expanded');
                        })
                        .catch(() => {});
                });
            }

            if (toggleGridExpanded && gridCanvasExpanded) {
                toggleGridExpanded.addEventListener('change', () => {
                    gridCanvasExpanded.style.display = toggleGridExpanded.checked ? 'block' : 'none';
                    if (toggleGridExpanded.checked) {
                        fetch('/api/display/current')
                            .then(r => r.json())
                            .then(data => {
                                if (!data || !data.width || !data.height) return;
                                const scale = parseInt((document.getElementById('scaleRangeExpanded')?.value) || '8');
                                drawGrid(gridCanvasExpanded, data.width, data.height, scale, 'Expanded');
                            })
                            .catch(() => {});
                    }
                });
                gridCanvasExpanded.style.display = 'none';
            }

            if (dotFillRangeExpanded && dotFillValueExpanded) {
                dotFillRangeExpanded.addEventListener('input', () => {
                    dotFillValueExpanded.textContent = `${dotFillRangeExpanded.value}%`;
                    renderLedDots('Expanded');
                });
            }
            
            if (toggleLedDotsExpanded) {
                toggleLedDotsExpanded.addEventListener('change', () => renderLedDots('Expanded'));
                if (toggleLedDotsExpanded.checked) {
                    setTimeout(() => renderLedDots('Expanded'), 200);
                }
            }
            
            // Initialize color pickers
            const textColorEl = document.getElementById('text_text_color');
            const textBgColorEl = document.getElementById('text_background_color');
            const newsTextColor = document.getElementById('news_text_color');
            const newsSepColor = document.getElementById('news_separator_color');
            if (textColorEl) initColor(textColorEl);
            if (textBgColorEl) initColor(textBgColorEl);
            if (newsTextColor) initColor(newsTextColor);
            if (newsSepColor) initColor(newsSepColor);
            
            setInterval(updateSystemStats, 30000);
            setInterval(updateApiMetrics, 60000);
        });
        
        // Tab switching with Tailwind classes
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active styling from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-secondary', 'text-secondary');
                btn.classList.add('border-transparent', 'text-gray-600');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            
            // Add active styling to clicked button
            if (event && event.target) {
                event.target.classList.remove('border-transparent', 'text-gray-600');
                event.target.classList.add('border-secondary', 'text-secondary');
            }
            
            // Load specific data when tabs are opened
            if (tabName === 'news') {
                loadNewsManagerData();
            } else if (tabName === 'sports') {
                refreshSportsConfig();
            } else if (tabName === 'logs') {
                fetchLogs();
            } else if (tabName === 'raw-json') {
                setTimeout(() => {
                    validateJson('main-config-json', 'main-config-validation');
                    validateJson('secrets-config-json', 'secrets-config-validation');
                }, 100);
            }
            
            refreshOnDemandStatus();
        }
        
        // Socket.IO initialization
        function initializeSocket() {
            socket = io({
                path: '/socket.io',
                transports: ['websocket', 'polling'],
                reconnection: true,
                reconnectionAttempts: Infinity,
                reconnectionDelay: 1000,
                reconnectionDelayMax: 10000
            });
            
            socket.on('connect', function() {
                updateConnectionStatus(true);
                showNotification('Connected to LED Matrix', 'success');
                stopPreviewPolling();
            });
            
            socket.on('disconnect', function() {
                updateConnectionStatus(false);
                showNotification('Disconnected from LED Matrix', 'error');
                startPreviewPolling();
            });
            
            socket.on('connect_error', function(){
                updateConnectionStatus(false);
                startPreviewPolling();
            });
            
            socket.on('display_update', function(data) {
                updateDisplayPreview(data);
            });
            
            socket.on('ondemand_error', function(data) {
                showNotification(`On-demand error: ${data.error}`, 'error');
                refreshOnDemandStatus();
            });
        }
        
        // Fallback polling when websocket disconnected
        let __previewPollTimer = null;
        function startPreviewPolling(){
            if (__previewPollTimer) return;
            __previewPollTimer = setInterval(fetchCurrentDisplayOnce, 1000);
        }
        function stopPreviewPolling(){
            if (__previewPollTimer) clearInterval(__previewPollTimer);
            __previewPollTimer = null;
        }
        async function fetchCurrentDisplayOnce(){
            try {
                const res = await fetch('/api/display/current');
                const data = await res.json();
                if (data && data.image) updateDisplayPreview(data);
            } catch (_) {}
        }
        
        // Draw pixel grid lines
        function drawGrid(canvas, logicalWidth, logicalHeight, scale, suffix = '') {
            const show = document.getElementById('toggleGrid' + suffix)?.checked;
            if (!canvas || !show) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'rgba(255,255,255,0.12)';
            ctx.lineWidth = 1;
            for (let x = 0; x <= logicalWidth; x++) {
                const px = Math.floor(x * scale) + 0.5;
                ctx.beginPath();
                ctx.moveTo(px, 0);
                ctx.lineTo(px, logicalHeight * scale);
                ctx.stroke();
            }
            for (let y = 0; y <= logicalHeight; y++) {
                const py = Math.floor(y * scale) + 0.5;
                ctx.beginPath();
                ctx.moveTo(0, py);
                ctx.lineTo(logicalWidth * scale, py);
                ctx.stroke();
            }
        }
        
        function renderLedDots(suffix = ''){
            const ledCanvas = document.getElementById('ledCanvas' + suffix);
            const img = document.getElementById('displayImage' + suffix);
            const toggle = document.getElementById('toggleLedDots' + suffix);
            if (!ledCanvas || !img || !toggle) return;
            const show = toggle.checked;
            ledCanvas.style.display = show ? 'block' : 'none';
            if (!show) return;
            const scale = parseInt(document.getElementById('scaleRange' + suffix).value || '8');
            const fillPct = parseInt(document.getElementById('dotFillRange' + suffix).value || '75');
            const dotRadius = Math.max(1, Math.floor((scale * fillPct) / 200));
            const ctx = ledCanvas.getContext('2d');
            ctx.clearRect(0, 0, ledCanvas.width, ledCanvas.height);
            const off = document.createElement('canvas');
            const logicalWidth = Math.floor(ledCanvas.width / scale);
            const logicalHeight = Math.floor(ledCanvas.height / scale);
            off.width = logicalWidth;
            off.height = logicalHeight;
            const offCtx = off.getContext('2d', { willReadFrequently: true });
            try { offCtx.drawImage(img, 0, 0, logicalWidth, logicalHeight); } catch (_) { }
            let drawn = 0;
            for (let y = 0; y < logicalHeight; y++) {
                for (let x = 0; x < logicalWidth; x++) {
                    const pixel = offCtx.getImageData(x, y, 1, 1).data;
                    const r = pixel[0], g = pixel[1], b = pixel[2], a = pixel[3];
                    if (a === 0 || (r|g|b) === 0) continue;
                    ctx.fillStyle = `rgb(${r},${g},${b})`;
                    const cx = Math.floor(x * scale + scale / 2);
                    const cy = Math.floor(y * scale + scale / 2);
                    ctx.beginPath();
                    ctx.arc(cx, cy, dotRadius, 0, Math.PI * 2);
                    ctx.fill();
                    drawn++;
                }
            }
            if (drawn === 0) ledCanvas.style.display = 'none';
        }
        
        async function toggleEditorMode() {
            try {
                const response = await fetch('/api/editor/toggle', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const result = await response.json();
                showNotification(result.message, result.status);
                if (result.status === 'success') {
                    editorMode = result.editor_mode;
                    location.reload();
                }
            } catch (error) {
                showNotification('Error toggling editor mode: ' + error.message, 'error');
            }
        }
        
        // Toggle floating preview minimize/maximize
        function toggleFloatingPreview() {
            const content = document.getElementById('previewContent');
            const icon = document.getElementById('minimizeIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-down';
            } else {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-up';
            }
        }
        
        // Toggle between floating (bottom-left) and expanded (center) preview modes
        function toggleDisplayPreviewMode() {
            const floatingPreview = document.getElementById('floatingPreview');
            const expandedPreview = document.getElementById('expandedPreview');
            
            if (floatingPreview.classList.contains('hidden')) {
                // Switch from expanded to floating
                expandedPreview.classList.add('hidden');
                floatingPreview.classList.remove('hidden');
                // Copy current image to floating view
                syncPreviewImage('expanded', 'floating');
            } else {
                // Switch from floating to expanded
                floatingPreview.classList.add('hidden');
                expandedPreview.classList.remove('hidden');
                // Make sure expanded preview content is visible
                const previewContent = document.getElementById('previewContent');
                if (previewContent.style.display === 'none') {
                    previewContent.style.display = 'block';
                }
                // Copy current image to expanded view
                syncPreviewImage('floating', 'expanded');
            }
        }
        
        // Sync preview image between floating and expanded views
        function syncPreviewImage(fromView, toView) {
            const fromSuffix = fromView === 'expanded' ? 'Expanded' : '';
            const toSuffix = toView === 'expanded' ? 'Expanded' : '';
            
            const fromImg = document.getElementById('displayImage' + fromSuffix);
            const toImg = document.getElementById('displayImage' + toSuffix);
            const fromStage = document.getElementById('previewStage' + fromSuffix);
            const toStage = document.getElementById('previewStage' + toSuffix);
            const fromPlaceholder = document.getElementById('displayPlaceholder' + fromSuffix);
            const toPlaceholder = document.getElementById('displayPlaceholder' + toSuffix);
            
            if (fromImg && toImg && fromImg.src) {
                toImg.src = fromImg.src;
                toImg.style.width = fromImg.style.width;
                toImg.style.height = fromImg.style.height;
                
                // Show/hide stage and placeholder accordingly
                if (!fromStage.classList.contains('hidden')) {
                    toStage.classList.remove('hidden');
                    toPlaceholder.classList.add('hidden');
                } else {
                    toStage.classList.add('hidden');
                    toPlaceholder.classList.remove('hidden');
                }
            }
        }

        async function takeScreenshot() {
            try {
                const response = await fetch('/api/display/current');
                const data = await response.json();
                if (data.image) {
                    const link = document.createElement('a');
                    link.href = 'data:image/png;base64,' + data.image;
                    link.download = 'led_matrix_screenshot_' + new Date().getTime() + '.png';
                    link.click();
                    showNotification('Screenshot saved', 'success');
                } else {
                    showNotification('No display data available', 'warning');
                }
            } catch (error) {
                showNotification('Error taking screenshot: ' + error.message, 'error');
            }
        }
        
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.className = 'fixed bottom-6 right-6 px-4 py-2 rounded-full shadow-lg text-white text-sm font-medium bg-green-500';
                status.innerHTML = '<i class="fas fa-wifi mr-2"></i>Connected';
            } else {
                status.className = 'fixed bottom-6 right-6 px-4 py-2 rounded-full shadow-lg text-white text-sm font-medium bg-red-500';
                status.innerHTML = '<i class="fas fa-wifi mr-2"></i>Disconnected';
            }
        }
        
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            notification.className = `px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 ${colors[type] || 'bg-gray-500'}`;
            notification.textContent = message;
            
            // Ensure positioning is set
            notification.style.position = 'fixed';
            notification.style.top = '5rem';
            notification.style.right = '1rem';
            notification.style.zIndex = '10000';
            
            // Slide in from right
            notification.style.opacity = '1';
            notification.style.transform = 'translateX(0)';
            
            setTimeout(() => {
                // Slide out to right
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(calc(100% + 2rem))';
            }, 3000);
        }
        
        // Note: Most functions are loaded from /static/js/v3-functions.js
        // Functions here use Jinja2 template variables and must be inline
        
        function updateDisplayPreview(data) {
            // Update both floating and expanded views
            updateDisplayView(data, ''); // Floating view
            updateDisplayView(data, 'Expanded'); // Expanded view
        }
        
        function updateDisplayView(data, suffix) {
            const stage = document.getElementById('previewStage' + suffix);
            const img = document.getElementById('displayImage' + suffix);
            const canvas = document.getElementById('gridOverlay' + suffix);
            const ledCanvas = document.getElementById('ledCanvas' + suffix);
            const placeholder = document.getElementById('displayPlaceholder' + suffix);
            const scaleRange = document.getElementById('scaleRange' + suffix);

            if (!stage || !img || !canvas || !ledCanvas || !placeholder) return;

            if (data.image) {
                placeholder.style.display = 'none';
                stage.style.display = 'inline-block';
                stage.classList.remove('hidden');
                const scale = parseInt(scaleRange?.value || '8');
                img.style.imageRendering = 'pixelated';
                img.onload = () => { renderLedDots(suffix); };
                img.src = `data:image/png;base64,${data.image}`;
                const meta = document.getElementById('previewMeta' + suffix);
                if (meta) {
                    const configWidth = {{ main_config.get('display', {}).get('hardware', {}).get('cols', 64) * main_config.get('display', {}).get('hardware', {}).get('chain_length', 1) }};
                    const configHeight = {{ main_config.get('display', {}).get('hardware', {}).get('rows', 32) * main_config.get('display', {}).get('hardware', {}).get('parallel', 1) }};
                    meta.textContent = `${data.width || configWidth} x ${data.height || configHeight} @ ${scale}x`;
                }
                const configWidth = {{ main_config.get('display', {}).get('hardware', {}).get('cols', 64) * main_config.get('display', {}).get('hardware', {}).get('chain_length', 1) }};
                const configHeight = {{ main_config.get('display', {}).get('hardware', {}).get('rows', 32) * main_config.get('display', {}).get('hardware', {}).get('parallel', 1) }};
                const width = (data.width || configWidth) * scale;
                const height = (data.height || configHeight) * scale;
                img.style.width = width + 'px';
                img.style.height = height + 'px';
                ledCanvas.width = width;
                ledCanvas.height = height;
                canvas.width = width;
                canvas.height = height;
                drawGrid(canvas, data.width || configWidth, data.height || configHeight, scale, suffix);
                renderLedDots(suffix);
            } else {
                stage.style.display = 'none';
                placeholder.style.display = 'block';
            }
        }

        async function systemAction(action) {
            if (action === 'reboot_system' && !confirm('Are you sure you want to reboot?')) return;
            if (action === 'migrate_config' && !confirm('Migrate config? A backup will be created.')) return;
            try {
                const response = await fetch('/api/system/action', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: action})
                });
                const result = await response.json();
                showNotification(result.message, result.status);
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function runAction(actionName) {
            const outputElement = document.getElementById('action_output');
            if (outputElement) outputElement.textContent = `Running ${actionName.replace(/_/g, ' ')}...`;
            try {
                const response = await fetch('/run_action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: actionName })
                });
                const data = await response.json();
                let outputText = `Status: ${data.status}\nMessage: ${data.message}\n`;
                if (data.stdout) outputText += `\n--- STDOUT ---\n${data.stdout}`;
                if (data.stderr) outputText += `\n--- STDERR ---\n${data.stderr}`;
                if (outputElement) outputElement.textContent = outputText;
                showNotification(data.message, data.status);
            } catch (error) {
                if (outputElement) outputElement.textContent = `Error: ${error}`;
                showNotification(`Error: ${error}`, 'error');
            }
        }

        function confirmShutdown(){
            if (!confirm('Are you sure you want to shut down the system?')) return;
            runAction('shutdown_system');
        }

        async function fetchLogs() {
            const logContent = document.getElementById('log-content');
            logContent.textContent = 'Loading logs...';
            try {
                const response = await fetch('/get_logs');
                const data = await response.json();
                logContent.textContent = data.status === 'success' ? data.logs : `Error: ${data.message}`;
            } catch (error) {
                logContent.textContent = `Error: ${error}`;
            }
        }
        
        // Quick Controls Dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            const quickControlsBtn = document.getElementById('quickControlsBtn');
            const quickControlsDropdown = document.getElementById('quickControlsDropdown');
            
            // Toggle dropdown visibility
            quickControlsBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                quickControlsDropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!quickControlsBtn.contains(e.target) && !quickControlsDropdown.contains(e.target)) {
                    quickControlsDropdown.classList.add('hidden');
                }
            });
            
            // Close dropdown when pressing Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    quickControlsDropdown.classList.add('hidden');
                }
            });
        });
        
        // Execute quick action function
        async function executeQuickAction(actionName) {
            // Close dropdown after selection
            const dropdown = document.getElementById('quickControlsDropdown');
            dropdown.classList.add('hidden');
            
            // Show loading notification
            showNotification(`Executing ${actionName.replace(/_/g, ' ')}...`, 'info');
            
            try {
                let response;
                
                // Determine which endpoint to use based on action type
                if (['start_display', 'stop_display'].includes(actionName)) {
                    response = await fetch('/run_action', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: actionName })
                    });
                } else {
                    response = await fetch('/api/system/action', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: actionName })
                    });
                }
                
                const data = await response.json();
                showNotification(data.message, data.status);
                
                // Refresh page data if needed
                if (['start_display', 'stop_display', 'restart_service'].includes(actionName)) {
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
                
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebar = document.getElementById('sidebar');
            const mobileOverlay = document.getElementById('mobile-overlay');
            
            // Check if we're on mobile
            function isMobile() {
                return window.innerWidth < 768;
            }
            
            // Toggle sidebar
            function toggleSidebar() {
                if (isMobile()) {
                    sidebar.classList.toggle('sidebar-open');
                    if (sidebar.classList.contains('sidebar-open')) {
                        mobileOverlay.style.display = 'block';
                        mobileOverlay.classList.add('overlay-show');
                    } else {
                        mobileOverlay.style.display = 'none';
                        mobileOverlay.classList.remove('overlay-show');
                    }
                }
            }
            
            // Close sidebar
            function closeSidebar() {
                if (isMobile()) {
                    sidebar.classList.remove('sidebar-open');
                    mobileOverlay.style.display = 'none';
                    mobileOverlay.classList.remove('overlay-show');
                }
            }
            
            // Mobile menu button click
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', toggleSidebar);
            }
            
            // Overlay click to close
            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', closeSidebar);
            }
            
            // Close sidebar when tab is selected on mobile
            const originalShowTab = window.showTab;
            window.showTab = function(tabName) {
                originalShowTab(tabName);
                // Close sidebar on mobile after tab selection
                if (isMobile()) {
                    closeSidebar();
                }
            };
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (isMobile()) {
                    // Mobile view - show hamburger button
                    if (mobileMenuButton) {
                        mobileMenuButton.style.display = 'block';
                    }
                    // Ensure sidebar is hidden by default on mobile
                    if (!sidebar.classList.contains('sidebar-open')) {
                        closeSidebar();
                    }
                } else {
                    // Desktop view - hide hamburger button and show sidebar
                    if (mobileMenuButton) {
                        mobileMenuButton.style.display = 'none';
                    }
                    sidebar.classList.remove('sidebar-open');
                    mobileOverlay.style.display = 'none';
                    mobileOverlay.classList.remove('overlay-show');
                }
            });
            
            // Initialize based on current screen size
            if (isMobile()) {
                if (mobileMenuButton) {
                    mobileMenuButton.style.display = 'block';
                }
                closeSidebar();
            } else {
                if (mobileMenuButton) {
                    mobileMenuButton.style.display = 'none';
                }
                mobileOverlay.style.display = 'none';
            }
            
            // Set overview tab as active by default
            showTab('overview');
        });

        // All additional functionality is loaded from /static/js/v3-functions.js
        // This file includes: form handlers, news manager, sports config, editor, JSON validation, and more
    </script>
            </div>
        </div>
    </div>
</body>
</html>
